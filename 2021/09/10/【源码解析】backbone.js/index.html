<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>【源码解析】backbone.js | 韦绍炜的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="wsw's Blog" />
  
  <meta name="description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">
<meta property="og:type" content="article">
<meta property="og:title" content="【源码解析】backbone.js">
<meta property="og:url" content="https://wisiw.github.io.git/2021/09/10/%E3%80%90%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E3%80%91backbone.js/index.html">
<meta property="og:site_name" content="韦绍炜的博客">
<meta property="og:description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">
<meta property="og:locale">
<meta property="article:published_time" content="2021-09-10T06:55:28.000Z">
<meta property="article:modified_time" content="2021-09-23T06:18:28.181Z">
<meta property="article:author" content="wsw">
<meta property="article:tag" content="源码">
<meta property="article:tag" content="backbone.js">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>

  

  
  

<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">wsw&#39;s Blog</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a  href="/">
                        <i class="fa fa-home"></i>
                        <span>Home</span>
                    </a>
                    
                    <a  href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>Archives</span>
                    </a>
                    
                    <a  href="/about">
                        <i class="fa fa-user"></i>
                        <span>About</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="/images/logo.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        wsw&#39;s Blog
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        人生路远,怎能不给自己找点乐子呢
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                        <a title="MinHow" target="_blank" href="http://blog.wswei.cn">
                            <i class="fa fa-home fa-2x"></i></a>
                    
                        <a title="Github" target="_blank" href="https://github.com/WiSiW">
                            <i class="fa fa-github fa-2x"></i></a>
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="post-【源码解析】backbone.js" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="post-title" itemprop="name">
      【源码解析】backbone.js
    </h1>
    <div class="post-title-bar">
      <ul>
          
        <li>
          <i class="fa fa-calendar"></i>  2021-09-10
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

          
      </header>
    
    <div class="article-entry post-content" itemprop="articleBody">
      
            
            <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br><span class="line">1865</span><br><span class="line">1866</span><br><span class="line">1867</span><br><span class="line">1868</span><br><span class="line">1869</span><br><span class="line">1870</span><br><span class="line">1871</span><br><span class="line">1872</span><br><span class="line">1873</span><br><span class="line">1874</span><br><span class="line">1875</span><br><span class="line">1876</span><br><span class="line">1877</span><br><span class="line">1878</span><br><span class="line">1879</span><br><span class="line">1880</span><br><span class="line">1881</span><br><span class="line">1882</span><br><span class="line">1883</span><br><span class="line">1884</span><br><span class="line">1885</span><br><span class="line">1886</span><br><span class="line">1887</span><br><span class="line">1888</span><br><span class="line">1889</span><br><span class="line">1890</span><br><span class="line">1891</span><br><span class="line">1892</span><br><span class="line">1893</span><br><span class="line">1894</span><br><span class="line">1895</span><br><span class="line">1896</span><br><span class="line">1897</span><br><span class="line">1898</span><br><span class="line">1899</span><br><span class="line">1900</span><br><span class="line">1901</span><br><span class="line">1902</span><br><span class="line">1903</span><br><span class="line">1904</span><br><span class="line">1905</span><br><span class="line">1906</span><br><span class="line">1907</span><br><span class="line">1908</span><br><span class="line">1909</span><br><span class="line">1910</span><br><span class="line">1911</span><br><span class="line">1912</span><br><span class="line">1913</span><br><span class="line">1914</span><br><span class="line">1915</span><br><span class="line">1916</span><br><span class="line">1917</span><br><span class="line">1918</span><br><span class="line">1919</span><br><span class="line">1920</span><br><span class="line">1921</span><br><span class="line">1922</span><br><span class="line">1923</span><br><span class="line">1924</span><br><span class="line">1925</span><br><span class="line">1926</span><br><span class="line">1927</span><br><span class="line">1928</span><br><span class="line">1929</span><br><span class="line">1930</span><br><span class="line">1931</span><br><span class="line">1932</span><br><span class="line">1933</span><br><span class="line">1934</span><br><span class="line">1935</span><br><span class="line">1936</span><br><span class="line">1937</span><br><span class="line">1938</span><br><span class="line">1939</span><br><span class="line">1940</span><br><span class="line">1941</span><br><span class="line">1942</span><br><span class="line">1943</span><br><span class="line">1944</span><br><span class="line">1945</span><br><span class="line">1946</span><br><span class="line">1947</span><br><span class="line">1948</span><br><span class="line">1949</span><br><span class="line">1950</span><br><span class="line">1951</span><br><span class="line">1952</span><br><span class="line">1953</span><br><span class="line">1954</span><br><span class="line">1955</span><br><span class="line">1956</span><br><span class="line">1957</span><br><span class="line">1958</span><br><span class="line">1959</span><br><span class="line">1960</span><br><span class="line">1961</span><br><span class="line">1962</span><br><span class="line">1963</span><br><span class="line">1964</span><br><span class="line">1965</span><br><span class="line">1966</span><br><span class="line">1967</span><br><span class="line">1968</span><br><span class="line">1969</span><br><span class="line">1970</span><br><span class="line">1971</span><br><span class="line">1972</span><br><span class="line">1973</span><br><span class="line">1974</span><br><span class="line">1975</span><br><span class="line">1976</span><br><span class="line">1977</span><br><span class="line">1978</span><br><span class="line">1979</span><br><span class="line">1980</span><br><span class="line">1981</span><br><span class="line">1982</span><br><span class="line">1983</span><br><span class="line">1984</span><br><span class="line">1985</span><br><span class="line">1986</span><br><span class="line">1987</span><br><span class="line">1988</span><br><span class="line">1989</span><br><span class="line">1990</span><br><span class="line">1991</span><br><span class="line">1992</span><br><span class="line">1993</span><br><span class="line">1994</span><br><span class="line">1995</span><br><span class="line">1996</span><br><span class="line">1997</span><br><span class="line">1998</span><br><span class="line">1999</span><br><span class="line">2000</span><br><span class="line">2001</span><br><span class="line">2002</span><br><span class="line">2003</span><br><span class="line">2004</span><br><span class="line">2005</span><br><span class="line">2006</span><br><span class="line">2007</span><br><span class="line">2008</span><br><span class="line">2009</span><br><span class="line">2010</span><br><span class="line">2011</span><br><span class="line">2012</span><br><span class="line">2013</span><br><span class="line">2014</span><br><span class="line">2015</span><br><span class="line">2016</span><br><span class="line">2017</span><br><span class="line">2018</span><br><span class="line">2019</span><br><span class="line">2020</span><br><span class="line">2021</span><br><span class="line">2022</span><br><span class="line">2023</span><br><span class="line">2024</span><br><span class="line">2025</span><br><span class="line">2026</span><br><span class="line">2027</span><br><span class="line">2028</span><br><span class="line">2029</span><br><span class="line">2030</span><br><span class="line">2031</span><br><span class="line">2032</span><br><span class="line">2033</span><br><span class="line">2034</span><br><span class="line">2035</span><br><span class="line">2036</span><br><span class="line">2037</span><br><span class="line">2038</span><br><span class="line">2039</span><br><span class="line">2040</span><br><span class="line">2041</span><br><span class="line">2042</span><br><span class="line">2043</span><br><span class="line">2044</span><br><span class="line">2045</span><br><span class="line">2046</span><br><span class="line">2047</span><br><span class="line">2048</span><br><span class="line">2049</span><br><span class="line">2050</span><br><span class="line">2051</span><br><span class="line">2052</span><br><span class="line">2053</span><br><span class="line">2054</span><br><span class="line">2055</span><br><span class="line">2056</span><br><span class="line">2057</span><br><span class="line">2058</span><br><span class="line">2059</span><br><span class="line">2060</span><br><span class="line">2061</span><br><span class="line">2062</span><br><span class="line">2063</span><br><span class="line">2064</span><br><span class="line">2065</span><br><span class="line">2066</span><br><span class="line">2067</span><br><span class="line">2068</span><br><span class="line">2069</span><br><span class="line">2070</span><br><span class="line">2071</span><br><span class="line">2072</span><br><span class="line">2073</span><br><span class="line">2074</span><br><span class="line">2075</span><br><span class="line">2076</span><br><span class="line">2077</span><br><span class="line">2078</span><br><span class="line">2079</span><br><span class="line">2080</span><br><span class="line">2081</span><br><span class="line">2082</span><br><span class="line">2083</span><br><span class="line">2084</span><br><span class="line">2085</span><br><span class="line">2086</span><br><span class="line">2087</span><br><span class="line">2088</span><br><span class="line">2089</span><br><span class="line">2090</span><br><span class="line">2091</span><br><span class="line">2092</span><br><span class="line">2093</span><br><span class="line">2094</span><br><span class="line">2095</span><br><span class="line">2096</span><br><span class="line">2097</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//     Backbone.js 1.4.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     (c) 2010-2019 Jeremy Ashkenas and DocumentCloud</span></span><br><span class="line"><span class="comment">//     Backbone may be freely distributed under the MIT license.</span></span><br><span class="line"><span class="comment">//     For all details and documentation:</span></span><br><span class="line"><span class="comment">//     http://backbonejs.org</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">factory</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Establish the root object, `window` (`self`) in the browser, or `global` on the server.</span></span><br><span class="line">  <span class="comment">// We use `self` instead of `window` for `WebWorker` support.</span></span><br><span class="line">  <span class="keyword">var</span> root = <span class="keyword">typeof</span> self == <span class="string">&#x27;object&#x27;</span> &amp;&amp; self.self === self &amp;&amp; self ||</span><br><span class="line">            <span class="keyword">typeof</span> <span class="built_in">global</span> == <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="built_in">global</span>.global === <span class="built_in">global</span> &amp;&amp; <span class="built_in">global</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set up Backbone appropriately for the environment. Start with AMD.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&#x27;function&#x27;</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">    define([<span class="string">&#x27;underscore&#x27;</span>, <span class="string">&#x27;jquery&#x27;</span>, <span class="string">&#x27;exports&#x27;</span>], <span class="function"><span class="keyword">function</span>(<span class="params">_, $, <span class="built_in">exports</span></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Export global even in AMD case in case this script is loaded with</span></span><br><span class="line">      <span class="comment">// others that may still expect a global Backbone.</span></span><br><span class="line">      root.Backbone = factory(root, <span class="built_in">exports</span>, _, $);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Next for Node.js or CommonJS. jQuery may not be needed as a module.</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">exports</span> !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">&#x27;underscore&#x27;</span>), $;</span><br><span class="line">    <span class="keyword">try</span> &#123; $ = <span class="built_in">require</span>(<span class="string">&#x27;jquery&#x27;</span>); &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    factory(root, <span class="built_in">exports</span>, _, $);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Finally, as a browser global.</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    root.Backbone = factory(root, &#123;&#125;, root._, root.jQuery || root.Zepto || root.ender || root.$);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)(<span class="function"><span class="keyword">function</span>(<span class="params">root, Backbone, _, $</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Initial Setup</span></span><br><span class="line">  <span class="comment">// -------------</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Save the previous value of the `Backbone` variable, so that it can be</span></span><br><span class="line">  <span class="comment">// restored later on, if `noConflict` is used.</span></span><br><span class="line">  <span class="keyword">var</span> previousBackbone = root.Backbone;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create a local reference to a common array method we&#x27;ll want to use later.</span></span><br><span class="line">  <span class="keyword">var</span> slice = <span class="built_in">Array</span>.prototype.slice;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Current version of the library. Keep in sync with `package.json`.</span></span><br><span class="line">  Backbone.VERSION = <span class="string">&#x27;1.4.0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// For Backbone&#x27;s purposes, jQuery, Zepto, Ender, or My Library (kidding) owns</span></span><br><span class="line">  <span class="comment">// the `$` variable.</span></span><br><span class="line">  Backbone.$ = $;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Runs Backbone.js in *noConflict* mode, returning the `Backbone` variable</span></span><br><span class="line">  <span class="comment">// to its previous owner. Returns a reference to this Backbone object.</span></span><br><span class="line">  Backbone.noConflict = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    root.Backbone = previousBackbone;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Turn on `emulateHTTP` to support legacy HTTP servers. Setting this option</span></span><br><span class="line">  <span class="comment">// will fake `&quot;PATCH&quot;`, `&quot;PUT&quot;` and `&quot;DELETE&quot;` requests via the `_method` parameter and</span></span><br><span class="line">  <span class="comment">// set a `X-Http-Method-Override` header.</span></span><br><span class="line">  Backbone.emulateHTTP = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Turn on `emulateJSON` to support legacy servers that can&#x27;t deal with direct</span></span><br><span class="line">  <span class="comment">// `application/json` requests ... this will encode the body as</span></span><br><span class="line">  <span class="comment">// `application/x-www-form-urlencoded` instead and will send the model in a</span></span><br><span class="line">  <span class="comment">// form param named `model`.</span></span><br><span class="line">  Backbone.emulateJSON = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Backbone.Events</span></span><br><span class="line">  <span class="comment">// ---------------</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A module that can be mixed in to *any object* in order to provide it with</span></span><br><span class="line">  <span class="comment">// a custom event channel. You may bind a callback to an event with `on` or</span></span><br><span class="line">  <span class="comment">// remove with `off`; `trigger`-ing an event fires all callbacks in</span></span><br><span class="line">  <span class="comment">// succession.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">//     var object = &#123;&#125;;</span></span><br><span class="line">  <span class="comment">//     _.extend(object, Backbone.Events);</span></span><br><span class="line">  <span class="comment">//     object.on(&#x27;expand&#x27;, function()&#123; alert(&#x27;expanded&#x27;); &#125;);</span></span><br><span class="line">  <span class="comment">//     object.trigger(&#x27;expand&#x27;);</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="keyword">var</span> Events = Backbone.Events = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Regular expression used to split event strings.</span></span><br><span class="line">  <span class="keyword">var</span> eventSplitter = <span class="regexp">/\s+/</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// A private global variable to share between listeners and listenees.</span></span><br><span class="line">  <span class="keyword">var</span> _listening;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Iterates over the standard `event, callback` (as well as the fancy multiple</span></span><br><span class="line">  <span class="comment">// space-separated events `&quot;change blur&quot;, callback` and jQuery-style event</span></span><br><span class="line">  <span class="comment">// maps `&#123;event: callback&#125;`).</span></span><br><span class="line">  <span class="keyword">var</span> eventsApi = <span class="function"><span class="keyword">function</span>(<span class="params">iteratee, events, name, callback, opts</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>, names;</span><br><span class="line">    <span class="keyword">if</span> (name &amp;&amp; <span class="keyword">typeof</span> name === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// Handle event maps.</span></span><br><span class="line">      <span class="keyword">if</span> (callback !== <span class="keyword">void</span> <span class="number">0</span> &amp;&amp; <span class="string">&#x27;context&#x27;</span> <span class="keyword">in</span> opts &amp;&amp; opts.context === <span class="keyword">void</span> <span class="number">0</span>) opts.context = callback;</span><br><span class="line">      <span class="keyword">for</span> (names = _.keys(name); i &lt; names.length ; i++) &#123;</span><br><span class="line">        events = eventsApi(iteratee, events, names[i], name[names[i]], opts);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name &amp;&amp; eventSplitter.test(name)) &#123;</span><br><span class="line">      <span class="comment">// Handle space-separated event names by delegating them individually.</span></span><br><span class="line">      <span class="keyword">for</span> (names = name.split(eventSplitter); i &lt; names.length; i++) &#123;</span><br><span class="line">        events = iteratee(events, names[i], callback, opts);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// Finally, standard events.</span></span><br><span class="line">      events = iteratee(events, name, callback, opts);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> events;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Bind an event to a `callback` function. Passing `&quot;all&quot;` will bind</span></span><br><span class="line">  <span class="comment">// the callback to all events fired.</span></span><br><span class="line">  Events.on = <span class="function"><span class="keyword">function</span>(<span class="params">name, callback, context</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>._events = eventsApi(onApi, <span class="built_in">this</span>._events || &#123;&#125;, name, callback, &#123;</span><br><span class="line">      context: context,</span><br><span class="line">      ctx: <span class="built_in">this</span>,</span><br><span class="line">      listening: _listening</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_listening) &#123;</span><br><span class="line">      <span class="keyword">var</span> listeners = <span class="built_in">this</span>._listeners || (<span class="built_in">this</span>._listeners = &#123;&#125;);</span><br><span class="line">      listeners[_listening.id] = _listening;</span><br><span class="line">      <span class="comment">// Allow the listening to use a counter, instead of tracking</span></span><br><span class="line">      <span class="comment">// callbacks for library interop</span></span><br><span class="line">      _listening.interop = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Inversion-of-control versions of `on`. Tell *this* object to listen to</span></span><br><span class="line">  <span class="comment">// an event in another object... keeping track of what it&#x27;s listening to</span></span><br><span class="line">  <span class="comment">// for easier unbinding later.</span></span><br><span class="line">  Events.listenTo = <span class="function"><span class="keyword">function</span>(<span class="params">obj, name, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!obj) <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">var</span> id = obj._listenId || (obj._listenId = _.uniqueId(<span class="string">&#x27;l&#x27;</span>));</span><br><span class="line">    <span class="keyword">var</span> listeningTo = <span class="built_in">this</span>._listeningTo || (<span class="built_in">this</span>._listeningTo = &#123;&#125;);</span><br><span class="line">    <span class="keyword">var</span> listening = _listening = listeningTo[id];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This object is not listening to any other events on `obj` yet.</span></span><br><span class="line">    <span class="comment">// Setup the necessary references to track the listening callbacks.</span></span><br><span class="line">    <span class="keyword">if</span> (!listening) &#123;</span><br><span class="line">      <span class="built_in">this</span>._listenId || (<span class="built_in">this</span>._listenId = _.uniqueId(<span class="string">&#x27;l&#x27;</span>));</span><br><span class="line">      listening = _listening = listeningTo[id] = <span class="keyword">new</span> Listening(<span class="built_in">this</span>, obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Bind callbacks on obj.</span></span><br><span class="line">    <span class="keyword">var</span> error = tryCatchOn(obj, name, callback, <span class="built_in">this</span>);</span><br><span class="line">    _listening = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">    <span class="comment">// If the target obj is not Backbone.Events, track events manually.</span></span><br><span class="line">    <span class="keyword">if</span> (listening.interop) listening.on(name, callback);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The reducing API that adds a callback to the `events` object.</span></span><br><span class="line">  <span class="keyword">var</span> onApi = <span class="function"><span class="keyword">function</span>(<span class="params">events, name, callback, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">      <span class="keyword">var</span> handlers = events[name] || (events[name] = []);</span><br><span class="line">      <span class="keyword">var</span> context = options.context, ctx = options.ctx, listening = options.listening;</span><br><span class="line">      <span class="keyword">if</span> (listening) listening.count++;</span><br><span class="line"></span><br><span class="line">      handlers.push(&#123;<span class="attr">callback</span>: callback, <span class="attr">context</span>: context, <span class="attr">ctx</span>: context || ctx, <span class="attr">listening</span>: listening&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> events;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// An try-catch guarded #on function, to prevent poisoning the global</span></span><br><span class="line">  <span class="comment">// `_listening` variable.</span></span><br><span class="line">  <span class="keyword">var</span> tryCatchOn = <span class="function"><span class="keyword">function</span>(<span class="params">obj, name, callback, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      obj.on(name, callback, context);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Remove one or many callbacks. If `context` is null, removes all</span></span><br><span class="line">  <span class="comment">// callbacks with that function. If `callback` is null, removes all</span></span><br><span class="line">  <span class="comment">// callbacks for the event. If `name` is null, removes all bound</span></span><br><span class="line">  <span class="comment">// callbacks for all events.</span></span><br><span class="line">  Events.off = <span class="function"><span class="keyword">function</span>(<span class="params">name, callback, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>._events) <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    <span class="built_in">this</span>._events = eventsApi(offApi, <span class="built_in">this</span>._events, name, callback, &#123;</span><br><span class="line">      context: context,</span><br><span class="line">      listeners: <span class="built_in">this</span>._listeners</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Tell this object to stop listening to either specific events ... or</span></span><br><span class="line">  <span class="comment">// to every object it&#x27;s currently listening to.</span></span><br><span class="line">  Events.stopListening = <span class="function"><span class="keyword">function</span>(<span class="params">obj, name, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> listeningTo = <span class="built_in">this</span>._listeningTo;</span><br><span class="line">    <span class="keyword">if</span> (!listeningTo) <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ids = obj ? [obj._listenId] : _.keys(listeningTo);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; ids.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> listening = listeningTo[ids[i]];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If listening doesn&#x27;t exist, this object is not currently</span></span><br><span class="line">      <span class="comment">// listening to obj. Break out early.</span></span><br><span class="line">      <span class="keyword">if</span> (!listening) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      listening.obj.off(name, callback, <span class="built_in">this</span>);</span><br><span class="line">      <span class="keyword">if</span> (listening.interop) listening.off(name, callback);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (_.isEmpty(listeningTo)) <span class="built_in">this</span>._listeningTo = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The reducing API that removes a callback from the `events` object.</span></span><br><span class="line">  <span class="keyword">var</span> offApi = <span class="function"><span class="keyword">function</span>(<span class="params">events, name, callback, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!events) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> context = options.context, listeners = options.listeners;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>, names;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Delete all event listeners and &quot;drop&quot; events.</span></span><br><span class="line">    <span class="keyword">if</span> (!name &amp;&amp; !context &amp;&amp; !callback) &#123;</span><br><span class="line">      <span class="keyword">for</span> (names = _.keys(listeners); i &lt; names.length; i++) &#123;</span><br><span class="line">        listeners[names[i]].cleanup();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    names = name ? [name] : _.keys(events);</span><br><span class="line">    <span class="keyword">for</span> (; i &lt; names.length; i++) &#123;</span><br><span class="line">      name = names[i];</span><br><span class="line">      <span class="keyword">var</span> handlers = events[name];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Bail out if there are no events stored.</span></span><br><span class="line">      <span class="keyword">if</span> (!handlers) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Find any remaining events.</span></span><br><span class="line">      <span class="keyword">var</span> remaining = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; handlers.length; j++) &#123;</span><br><span class="line">        <span class="keyword">var</span> handler = handlers[j];</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          callback &amp;&amp; callback !== handler.callback &amp;&amp;</span><br><span class="line">            callback !== handler.callback._callback ||</span><br><span class="line">              context &amp;&amp; context !== handler.context</span><br><span class="line">        ) &#123;</span><br><span class="line">          remaining.push(handler);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> listening = handler.listening;</span><br><span class="line">          <span class="keyword">if</span> (listening) listening.off(name, callback);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Replace events if there are any remaining.  Otherwise, clean up.</span></span><br><span class="line">      <span class="keyword">if</span> (remaining.length) &#123;</span><br><span class="line">        events[name] = remaining;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">delete</span> events[name];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> events;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Bind an event to only be triggered a single time. After the first time</span></span><br><span class="line">  <span class="comment">// the callback is invoked, its listener will be removed. If multiple events</span></span><br><span class="line">  <span class="comment">// are passed in using the space-separated syntax, the handler will fire</span></span><br><span class="line">  <span class="comment">// once for each event, not once for a combination of all events.</span></span><br><span class="line">  Events.once = <span class="function"><span class="keyword">function</span>(<span class="params">name, callback, context</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Map the event into a `&#123;event: once&#125;` object.</span></span><br><span class="line">    <span class="keyword">var</span> events = eventsApi(onceMap, &#123;&#125;, name, callback, <span class="built_in">this</span>.off.bind(<span class="built_in">this</span>));</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> name === <span class="string">&#x27;string&#x27;</span> &amp;&amp; context == <span class="literal">null</span>) callback = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.on(events, callback, context);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Inversion-of-control versions of `once`.</span></span><br><span class="line">  Events.listenToOnce = <span class="function"><span class="keyword">function</span>(<span class="params">obj, name, callback</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Map the event into a `&#123;event: once&#125;` object.</span></span><br><span class="line">    <span class="keyword">var</span> events = eventsApi(onceMap, &#123;&#125;, name, callback, <span class="built_in">this</span>.stopListening.bind(<span class="built_in">this</span>, obj));</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.listenTo(obj, events);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Reduces the event callbacks into a map of `&#123;event: onceWrapper&#125;`.</span></span><br><span class="line">  <span class="comment">// `offer` unbinds the `onceWrapper` after it has been called.</span></span><br><span class="line">  <span class="keyword">var</span> onceMap = <span class="function"><span class="keyword">function</span>(<span class="params">map, name, callback, offer</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">      <span class="keyword">var</span> once = map[name] = _.once(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        offer(name, once);</span><br><span class="line">        callback.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">      once._callback = callback;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Trigger one or many events, firing all bound callbacks. Callbacks are</span></span><br><span class="line">  <span class="comment">// passed the same arguments as `trigger` is, apart from the event name</span></span><br><span class="line">  <span class="comment">// (unless you&#x27;re listening on `&quot;all&quot;`, which will cause your callback to</span></span><br><span class="line">  <span class="comment">// receive the true name of the event as the first argument).</span></span><br><span class="line">  Events.trigger = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>._events) <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> length = <span class="built_in">Math</span>.max(<span class="number">0</span>, <span class="built_in">arguments</span>.length - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> args = <span class="built_in">Array</span>(length);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++) args[i] = <span class="built_in">arguments</span>[i + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    eventsApi(triggerApi, <span class="built_in">this</span>._events, name, <span class="keyword">void</span> <span class="number">0</span>, args);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Handles triggering the appropriate event callbacks.</span></span><br><span class="line">  <span class="keyword">var</span> triggerApi = <span class="function"><span class="keyword">function</span>(<span class="params">objEvents, name, callback, args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (objEvents) &#123;</span><br><span class="line">      <span class="keyword">var</span> events = objEvents[name];</span><br><span class="line">      <span class="keyword">var</span> allEvents = objEvents.all;</span><br><span class="line">      <span class="keyword">if</span> (events &amp;&amp; allEvents) allEvents = allEvents.slice();</span><br><span class="line">      <span class="keyword">if</span> (events) triggerEvents(events, args);</span><br><span class="line">      <span class="keyword">if</span> (allEvents) triggerEvents(allEvents, [name].concat(args));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> objEvents;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// A difficult-to-believe, but optimized internal dispatch function for</span></span><br><span class="line">  <span class="comment">// triggering events. Tries to keep the usual cases speedy (most internal</span></span><br><span class="line">  <span class="comment">// Backbone events have 3 arguments).</span></span><br><span class="line">  <span class="keyword">var</span> triggerEvents = <span class="function"><span class="keyword">function</span>(<span class="params">events, args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ev, i = -<span class="number">1</span>, l = events.length, a1 = args[<span class="number">0</span>], a2 = args[<span class="number">1</span>], a3 = args[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">switch</span> (args.length) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">while</span> (++i &lt; l) (ev = events[i]).callback.call(ev.ctx); <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">while</span> (++i &lt; l) (ev = events[i]).callback.call(ev.ctx, a1); <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">while</span> (++i &lt; l) (ev = events[i]).callback.call(ev.ctx, a1, a2); <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>: <span class="keyword">while</span> (++i &lt; l) (ev = events[i]).callback.call(ev.ctx, a1, a2, a3); <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">default</span>: <span class="keyword">while</span> (++i &lt; l) (ev = events[i]).callback.apply(ev.ctx, args); <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// A listening class that tracks and cleans up memory bindings</span></span><br><span class="line">  <span class="comment">// when all callbacks have been offed.</span></span><br><span class="line">  <span class="keyword">var</span> Listening = <span class="function"><span class="keyword">function</span>(<span class="params">listener, obj</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.id = listener._listenId;</span><br><span class="line">    <span class="built_in">this</span>.listener = listener;</span><br><span class="line">    <span class="built_in">this</span>.obj = obj;</span><br><span class="line">    <span class="built_in">this</span>.interop = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">this</span>.count = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>._events = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  Listening.prototype.on = Events.on;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Offs a callback (or several).</span></span><br><span class="line">  <span class="comment">// Uses an optimized counter if the listenee uses Backbone.Events.</span></span><br><span class="line">  <span class="comment">// Otherwise, falls back to manual tracking to support events</span></span><br><span class="line">  <span class="comment">// library interop.</span></span><br><span class="line">  Listening.prototype.off = <span class="function"><span class="keyword">function</span>(<span class="params">name, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> cleanup;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.interop) &#123;</span><br><span class="line">      <span class="built_in">this</span>._events = eventsApi(offApi, <span class="built_in">this</span>._events, name, callback, &#123;</span><br><span class="line">        context: <span class="keyword">void</span> <span class="number">0</span>,</span><br><span class="line">        listeners: <span class="keyword">void</span> <span class="number">0</span></span><br><span class="line">      &#125;);</span><br><span class="line">      cleanup = !<span class="built_in">this</span>._events;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.count--;</span><br><span class="line">      cleanup = <span class="built_in">this</span>.count === <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cleanup) <span class="built_in">this</span>.cleanup();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Cleans up memory bindings between the listener and the listenee.</span></span><br><span class="line">  Listening.prototype.cleanup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">delete</span> <span class="built_in">this</span>.listener._listeningTo[<span class="built_in">this</span>.obj._listenId];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.interop) <span class="keyword">delete</span> <span class="built_in">this</span>.obj._listeners[<span class="built_in">this</span>.id];</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Aliases for backwards compatibility.</span></span><br><span class="line">  Events.bind   = Events.on;</span><br><span class="line">  Events.unbind = Events.off;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Allow the `Backbone` object to serve as a global event bus, for folks who</span></span><br><span class="line">  <span class="comment">// want global &quot;pubsub&quot; in a convenient place.</span></span><br><span class="line">  _.extend(Backbone, Events);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Backbone.Model</span></span><br><span class="line">  <span class="comment">// --------------</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Backbone **Models** are the basic data object in the framework --</span></span><br><span class="line">  <span class="comment">// frequently representing a row in a table in a database on your server.</span></span><br><span class="line">  <span class="comment">// A discrete chunk of data and a bunch of useful, related methods for</span></span><br><span class="line">  <span class="comment">// performing computations and transformations on that data.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create a new model with the specified attributes. A client id (`cid`)</span></span><br><span class="line">  <span class="comment">// is automatically generated and assigned for you.</span></span><br><span class="line">  <span class="keyword">var</span> Model = Backbone.Model = <span class="function"><span class="keyword">function</span>(<span class="params">attributes, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> attrs = attributes || &#123;&#125;;</span><br><span class="line">    options || (options = &#123;&#125;);</span><br><span class="line">    <span class="built_in">this</span>.preinitialize.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="built_in">this</span>.cid = _.uniqueId(<span class="built_in">this</span>.cidPrefix);</span><br><span class="line">    <span class="built_in">this</span>.attributes = &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (options.collection) <span class="built_in">this</span>.collection = options.collection;</span><br><span class="line">    <span class="keyword">if</span> (options.parse) attrs = <span class="built_in">this</span>.parse(attrs, options) || &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> defaults = _.result(<span class="built_in">this</span>, <span class="string">&#x27;defaults&#x27;</span>);</span><br><span class="line">    attrs = _.defaults(_.extend(&#123;&#125;, defaults, attrs), defaults);</span><br><span class="line">    <span class="built_in">this</span>.set(attrs, options);</span><br><span class="line">    <span class="built_in">this</span>.changed = &#123;&#125;;</span><br><span class="line">    <span class="built_in">this</span>.initialize.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Attach all inheritable methods to the Model prototype.</span></span><br><span class="line">  _.extend(Model.prototype, Events, &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A hash of attributes whose current and previous value differ.</span></span><br><span class="line">    changed: <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The value returned during the last failed validation.</span></span><br><span class="line">    validationError: <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The default name for the JSON `id` attribute is `&quot;id&quot;`. MongoDB and</span></span><br><span class="line">    <span class="comment">// CouchDB users may want to set this to `&quot;_id&quot;`.</span></span><br><span class="line">    idAttribute: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The prefix is used to create the client id which is used to identify models locally.</span></span><br><span class="line">    <span class="comment">// You may want to override this if you&#x27;re experiencing name clashes with model ids.</span></span><br><span class="line">    cidPrefix: <span class="string">&#x27;c&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// preinitialize is an empty function by default. You can override it with a function</span></span><br><span class="line">    <span class="comment">// or object.  preinitialize will run before any instantiation logic is run in the Model.</span></span><br><span class="line">    preinitialize: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize is an empty function by default. Override it with your own</span></span><br><span class="line">    <span class="comment">// initialization logic.</span></span><br><span class="line">    initialize: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return a copy of the model&#x27;s `attributes` object.</span></span><br><span class="line">    toJSON: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> _.clone(<span class="built_in">this</span>.attributes);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Proxy `Backbone.sync` by default -- but override this if you need</span></span><br><span class="line">    <span class="comment">// custom syncing semantics for *this* particular model.</span></span><br><span class="line">    sync: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> Backbone.sync.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the value of an attribute.</span></span><br><span class="line">    get: <span class="function"><span class="keyword">function</span>(<span class="params">attr</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.attributes[attr];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the HTML-escaped value of an attribute.</span></span><br><span class="line">    <span class="built_in">escape</span>: <span class="function"><span class="keyword">function</span>(<span class="params">attr</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> _.escape(<span class="built_in">this</span>.get(attr));</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Returns `true` if the attribute contains a value that is not null</span></span><br><span class="line">    <span class="comment">// or undefined.</span></span><br><span class="line">    has: <span class="function"><span class="keyword">function</span>(<span class="params">attr</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.get(attr) != <span class="literal">null</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Special-cased proxy to underscore&#x27;s `_.matches` method.</span></span><br><span class="line">    matches: <span class="function"><span class="keyword">function</span>(<span class="params">attrs</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> !!_.iteratee(attrs, <span class="built_in">this</span>)(<span class="built_in">this</span>.attributes);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set a hash of model attributes on the object, firing `&quot;change&quot;`. This is</span></span><br><span class="line">    <span class="comment">// the core primitive operation of a model, updating the data and notifying</span></span><br><span class="line">    <span class="comment">// anyone who needs to know about the change in state. The heart of the beast.</span></span><br><span class="line">    set: <span class="function"><span class="keyword">function</span>(<span class="params">key, val, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (key == <span class="literal">null</span>) <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Handle both `&quot;key&quot;, value` and `&#123;key: value&#125;` -style arguments.</span></span><br><span class="line">      <span class="keyword">var</span> attrs;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> key === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">        attrs = key;</span><br><span class="line">        options = val;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        (attrs = &#123;&#125;)[key] = val;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      options || (options = &#123;&#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Run validation.</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">this</span>._validate(attrs, options)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Extract attributes and options.</span></span><br><span class="line">      <span class="keyword">var</span> unset      = options.unset;</span><br><span class="line">      <span class="keyword">var</span> silent     = options.silent;</span><br><span class="line">      <span class="keyword">var</span> changes    = [];</span><br><span class="line">      <span class="keyword">var</span> changing   = <span class="built_in">this</span>._changing;</span><br><span class="line">      <span class="built_in">this</span>._changing = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!changing) &#123;</span><br><span class="line">        <span class="built_in">this</span>._previousAttributes = _.clone(<span class="built_in">this</span>.attributes);</span><br><span class="line">        <span class="built_in">this</span>.changed = &#123;&#125;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> current = <span class="built_in">this</span>.attributes;</span><br><span class="line">      <span class="keyword">var</span> changed = <span class="built_in">this</span>.changed;</span><br><span class="line">      <span class="keyword">var</span> prev    = <span class="built_in">this</span>._previousAttributes;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// For each `set` attribute, update or delete the current value.</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> attrs) &#123;</span><br><span class="line">        val = attrs[attr];</span><br><span class="line">        <span class="keyword">if</span> (!_.isEqual(current[attr], val)) changes.push(attr);</span><br><span class="line">        <span class="keyword">if</span> (!_.isEqual(prev[attr], val)) &#123;</span><br><span class="line">          changed[attr] = val;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">delete</span> changed[attr];</span><br><span class="line">        &#125;</span><br><span class="line">        unset ? <span class="keyword">delete</span> current[attr] : current[attr] = val;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Update the `id`.</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.idAttribute <span class="keyword">in</span> attrs) <span class="built_in">this</span>.id = <span class="built_in">this</span>.get(<span class="built_in">this</span>.idAttribute);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Trigger all relevant attribute changes.</span></span><br><span class="line">      <span class="keyword">if</span> (!silent) &#123;</span><br><span class="line">        <span class="keyword">if</span> (changes.length) <span class="built_in">this</span>._pending = options;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; changes.length; i++) &#123;</span><br><span class="line">          <span class="built_in">this</span>.trigger(<span class="string">&#x27;change:&#x27;</span> + changes[i], <span class="built_in">this</span>, current[changes[i]], options);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// You might be wondering why there&#x27;s a `while` loop here. Changes can</span></span><br><span class="line">      <span class="comment">// be recursively nested within `&quot;change&quot;` events.</span></span><br><span class="line">      <span class="keyword">if</span> (changing) <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">      <span class="keyword">if</span> (!silent) &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">this</span>._pending) &#123;</span><br><span class="line">          options = <span class="built_in">this</span>._pending;</span><br><span class="line">          <span class="built_in">this</span>._pending = <span class="literal">false</span>;</span><br><span class="line">          <span class="built_in">this</span>.trigger(<span class="string">&#x27;change&#x27;</span>, <span class="built_in">this</span>, options);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>._pending = <span class="literal">false</span>;</span><br><span class="line">      <span class="built_in">this</span>._changing = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove an attribute from the model, firing `&quot;change&quot;`. `unset` is a noop</span></span><br><span class="line">    <span class="comment">// if the attribute doesn&#x27;t exist.</span></span><br><span class="line">    unset: <span class="function"><span class="keyword">function</span>(<span class="params">attr, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.set(attr, <span class="keyword">void</span> <span class="number">0</span>, _.extend(&#123;&#125;, options, &#123;<span class="attr">unset</span>: <span class="literal">true</span>&#125;));</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Clear all attributes on the model, firing `&quot;change&quot;`.</span></span><br><span class="line">    clear: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> attrs = &#123;&#125;;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> <span class="built_in">this</span>.attributes) attrs[key] = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.set(attrs, _.extend(&#123;&#125;, options, &#123;<span class="attr">unset</span>: <span class="literal">true</span>&#125;));</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine if the model has changed since the last `&quot;change&quot;` event.</span></span><br><span class="line">    <span class="comment">// If you specify an attribute name, determine if that attribute has changed.</span></span><br><span class="line">    hasChanged: <span class="function"><span class="keyword">function</span>(<span class="params">attr</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (attr == <span class="literal">null</span>) <span class="keyword">return</span> !_.isEmpty(<span class="built_in">this</span>.changed);</span><br><span class="line">      <span class="keyword">return</span> _.has(<span class="built_in">this</span>.changed, attr);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return an object containing all the attributes that have changed, or</span></span><br><span class="line">    <span class="comment">// false if there are no changed attributes. Useful for determining what</span></span><br><span class="line">    <span class="comment">// parts of a view need to be updated and/or what attributes need to be</span></span><br><span class="line">    <span class="comment">// persisted to the server. Unset attributes will be set to undefined.</span></span><br><span class="line">    <span class="comment">// You can also pass an attributes object to diff against the model,</span></span><br><span class="line">    <span class="comment">// determining if there *would be* a change.</span></span><br><span class="line">    changedAttributes: <span class="function"><span class="keyword">function</span>(<span class="params">diff</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!diff) <span class="keyword">return</span> <span class="built_in">this</span>.hasChanged() ? _.clone(<span class="built_in">this</span>.changed) : <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">var</span> old = <span class="built_in">this</span>._changing ? <span class="built_in">this</span>._previousAttributes : <span class="built_in">this</span>.attributes;</span><br><span class="line">      <span class="keyword">var</span> changed = &#123;&#125;;</span><br><span class="line">      <span class="keyword">var</span> hasChanged;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> diff) &#123;</span><br><span class="line">        <span class="keyword">var</span> val = diff[attr];</span><br><span class="line">        <span class="keyword">if</span> (_.isEqual(old[attr], val)) <span class="keyword">continue</span>;</span><br><span class="line">        changed[attr] = val;</span><br><span class="line">        hasChanged = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> hasChanged ? changed : <span class="literal">false</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the previous value of an attribute, recorded at the time the last</span></span><br><span class="line">    <span class="comment">// `&quot;change&quot;` event was fired.</span></span><br><span class="line">    previous: <span class="function"><span class="keyword">function</span>(<span class="params">attr</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (attr == <span class="literal">null</span> || !<span class="built_in">this</span>._previousAttributes) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>._previousAttributes[attr];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get all of the attributes of the model at the time of the previous</span></span><br><span class="line">    <span class="comment">// `&quot;change&quot;` event.</span></span><br><span class="line">    previousAttributes: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> _.clone(<span class="built_in">this</span>._previousAttributes);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fetch the model from the server, merging the response with the model&#x27;s</span></span><br><span class="line">    <span class="comment">// local attributes. Any changed attributes will trigger a &quot;change&quot; event.</span></span><br><span class="line">    fetch: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      options = _.extend(&#123;<span class="attr">parse</span>: <span class="literal">true</span>&#125;, options);</span><br><span class="line">      <span class="keyword">var</span> model = <span class="built_in">this</span>;</span><br><span class="line">      <span class="keyword">var</span> success = options.success;</span><br><span class="line">      options.success = <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> serverAttrs = options.parse ? model.parse(resp, options) : resp;</span><br><span class="line">        <span class="keyword">if</span> (!model.set(serverAttrs, options)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (success) success.call(options.context, model, resp, options);</span><br><span class="line">        model.trigger(<span class="string">&#x27;sync&#x27;</span>, model, resp, options);</span><br><span class="line">      &#125;;</span><br><span class="line">      wrapError(<span class="built_in">this</span>, options);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.sync(<span class="string">&#x27;read&#x27;</span>, <span class="built_in">this</span>, options);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set a hash of model attributes, and sync the model to the server.</span></span><br><span class="line">    <span class="comment">// If the server returns an attributes hash that differs, the model&#x27;s</span></span><br><span class="line">    <span class="comment">// state will be `set` again.</span></span><br><span class="line">    save: <span class="function"><span class="keyword">function</span>(<span class="params">key, val, options</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Handle both `&quot;key&quot;, value` and `&#123;key: value&#125;` -style arguments.</span></span><br><span class="line">      <span class="keyword">var</span> attrs;</span><br><span class="line">      <span class="keyword">if</span> (key == <span class="literal">null</span> || <span class="keyword">typeof</span> key === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">        attrs = key;</span><br><span class="line">        options = val;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        (attrs = &#123;&#125;)[key] = val;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      options = _.extend(&#123;<span class="attr">validate</span>: <span class="literal">true</span>, <span class="attr">parse</span>: <span class="literal">true</span>&#125;, options);</span><br><span class="line">      <span class="keyword">var</span> wait = options.wait;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If we&#x27;re not waiting and attributes exist, save acts as</span></span><br><span class="line">      <span class="comment">// `set(attr).save(null, opts)` with validation. Otherwise, check if</span></span><br><span class="line">      <span class="comment">// the model will be valid when the attributes, if any, are set.</span></span><br><span class="line">      <span class="keyword">if</span> (attrs &amp;&amp; !wait) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.set(attrs, options)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">this</span>._validate(attrs, options)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// After a successful server-side save, the client is (optionally)</span></span><br><span class="line">      <span class="comment">// updated with the server-side state.</span></span><br><span class="line">      <span class="keyword">var</span> model = <span class="built_in">this</span>;</span><br><span class="line">      <span class="keyword">var</span> success = options.success;</span><br><span class="line">      <span class="keyword">var</span> attributes = <span class="built_in">this</span>.attributes;</span><br><span class="line">      options.success = <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Ensure attributes are restored during synchronous saves.</span></span><br><span class="line">        model.attributes = attributes;</span><br><span class="line">        <span class="keyword">var</span> serverAttrs = options.parse ? model.parse(resp, options) : resp;</span><br><span class="line">        <span class="keyword">if</span> (wait) serverAttrs = _.extend(&#123;&#125;, attrs, serverAttrs);</span><br><span class="line">        <span class="keyword">if</span> (serverAttrs &amp;&amp; !model.set(serverAttrs, options)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (success) success.call(options.context, model, resp, options);</span><br><span class="line">        model.trigger(<span class="string">&#x27;sync&#x27;</span>, model, resp, options);</span><br><span class="line">      &#125;;</span><br><span class="line">      wrapError(<span class="built_in">this</span>, options);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set temporary attributes if `&#123;wait: true&#125;` to properly find new ids.</span></span><br><span class="line">      <span class="keyword">if</span> (attrs &amp;&amp; wait) <span class="built_in">this</span>.attributes = _.extend(&#123;&#125;, attributes, attrs);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> method = <span class="built_in">this</span>.isNew() ? <span class="string">&#x27;create&#x27;</span> : options.patch ? <span class="string">&#x27;patch&#x27;</span> : <span class="string">&#x27;update&#x27;</span>;</span><br><span class="line">      <span class="keyword">if</span> (method === <span class="string">&#x27;patch&#x27;</span> &amp;&amp; !options.attrs) options.attrs = attrs;</span><br><span class="line">      <span class="keyword">var</span> xhr = <span class="built_in">this</span>.sync(method, <span class="built_in">this</span>, options);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Restore attributes.</span></span><br><span class="line">      <span class="built_in">this</span>.attributes = attributes;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> xhr;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Destroy this model on the server if it was already persisted.</span></span><br><span class="line">    <span class="comment">// Optimistically removes the model from its collection, if it has one.</span></span><br><span class="line">    <span class="comment">// If `wait: true` is passed, waits for the server to respond before removal.</span></span><br><span class="line">    destroy: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      options = options ? _.clone(options) : &#123;&#125;;</span><br><span class="line">      <span class="keyword">var</span> model = <span class="built_in">this</span>;</span><br><span class="line">      <span class="keyword">var</span> success = options.success;</span><br><span class="line">      <span class="keyword">var</span> wait = options.wait;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> destroy = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        model.stopListening();</span><br><span class="line">        model.trigger(<span class="string">&#x27;destroy&#x27;</span>, model, model.collection, options);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      options.success = <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (wait) destroy();</span><br><span class="line">        <span class="keyword">if</span> (success) success.call(options.context, model, resp, options);</span><br><span class="line">        <span class="keyword">if</span> (!model.isNew()) model.trigger(<span class="string">&#x27;sync&#x27;</span>, model, resp, options);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> xhr = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.isNew()) &#123;</span><br><span class="line">        _.defer(options.success);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        wrapError(<span class="built_in">this</span>, options);</span><br><span class="line">        xhr = <span class="built_in">this</span>.sync(<span class="string">&#x27;delete&#x27;</span>, <span class="built_in">this</span>, options);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!wait) destroy();</span><br><span class="line">      <span class="keyword">return</span> xhr;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Default URL for the model&#x27;s representation on the server -- if you&#x27;re</span></span><br><span class="line">    <span class="comment">// using Backbone&#x27;s restful methods, override this to change the endpoint</span></span><br><span class="line">    <span class="comment">// that will be called.</span></span><br><span class="line">    url: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> base =</span><br><span class="line">        _.result(<span class="built_in">this</span>, <span class="string">&#x27;urlRoot&#x27;</span>) ||</span><br><span class="line">        _.result(<span class="built_in">this</span>.collection, <span class="string">&#x27;url&#x27;</span>) ||</span><br><span class="line">        urlError();</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.isNew()) <span class="keyword">return</span> base;</span><br><span class="line">      <span class="keyword">var</span> id = <span class="built_in">this</span>.get(<span class="built_in">this</span>.idAttribute);</span><br><span class="line">      <span class="keyword">return</span> base.replace(<span class="regexp">/[^\/]$/</span>, <span class="string">&#x27;$&amp;/&#x27;</span>) + <span class="built_in">encodeURIComponent</span>(id);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// **parse** converts a response into the hash of attributes to be `set` on</span></span><br><span class="line">    <span class="comment">// the model. The default implementation is just to pass the response along.</span></span><br><span class="line">    parse: <span class="function"><span class="keyword">function</span>(<span class="params">resp, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> resp;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a new model with identical attributes to this one.</span></span><br><span class="line">    clone: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">this</span>.constructor(<span class="built_in">this</span>.attributes);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A model is new if it has never been saved to the server, and lacks an id.</span></span><br><span class="line">    isNew: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> !<span class="built_in">this</span>.has(<span class="built_in">this</span>.idAttribute);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check if the model is currently in a valid state.</span></span><br><span class="line">    isValid: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>._validate(&#123;&#125;, _.extend(&#123;&#125;, options, &#123;<span class="attr">validate</span>: <span class="literal">true</span>&#125;));</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Run validation against the next complete set of model attributes,</span></span><br><span class="line">    <span class="comment">// returning `true` if all is well. Otherwise, fire an `&quot;invalid&quot;` event.</span></span><br><span class="line">    _validate: <span class="function"><span class="keyword">function</span>(<span class="params">attrs, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!options.validate || !<span class="built_in">this</span>.validate) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      attrs = _.extend(&#123;&#125;, <span class="built_in">this</span>.attributes, attrs);</span><br><span class="line">      <span class="keyword">var</span> error = <span class="built_in">this</span>.validationError = <span class="built_in">this</span>.validate(attrs, options) || <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">if</span> (!error) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      <span class="built_in">this</span>.trigger(<span class="string">&#x27;invalid&#x27;</span>, <span class="built_in">this</span>, error, _.extend(options, &#123;<span class="attr">validationError</span>: error&#125;));</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Backbone.Collection</span></span><br><span class="line">  <span class="comment">// -------------------</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// If models tend to represent a single row of data, a Backbone Collection is</span></span><br><span class="line">  <span class="comment">// more analogous to a table full of data ... or a small slice or page of that</span></span><br><span class="line">  <span class="comment">// table, or a collection of rows that belong together for a particular reason</span></span><br><span class="line">  <span class="comment">// -- all of the messages in this particular folder, all of the documents</span></span><br><span class="line">  <span class="comment">// belonging to this particular author, and so on. Collections maintain</span></span><br><span class="line">  <span class="comment">// indexes of their models, both in order, and for lookup by `id`.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create a new **Collection**, perhaps to contain a specific type of `model`.</span></span><br><span class="line">  <span class="comment">// If a `comparator` is specified, the Collection will maintain</span></span><br><span class="line">  <span class="comment">// its models in sort order, as they&#x27;re added and removed.</span></span><br><span class="line">  <span class="keyword">var</span> Collection = Backbone.Collection = <span class="function"><span class="keyword">function</span>(<span class="params">models, options</span>) </span>&#123;</span><br><span class="line">    options || (options = &#123;&#125;);</span><br><span class="line">    <span class="built_in">this</span>.preinitialize.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">if</span> (options.model) <span class="built_in">this</span>.model = options.model;</span><br><span class="line">    <span class="keyword">if</span> (options.comparator !== <span class="keyword">void</span> <span class="number">0</span>) <span class="built_in">this</span>.comparator = options.comparator;</span><br><span class="line">    <span class="built_in">this</span>._reset();</span><br><span class="line">    <span class="built_in">this</span>.initialize.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">if</span> (models) <span class="built_in">this</span>.reset(models, _.extend(&#123;<span class="attr">silent</span>: <span class="literal">true</span>&#125;, options));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Default options for `Collection#set`.</span></span><br><span class="line">  <span class="keyword">var</span> setOptions = &#123;<span class="attr">add</span>: <span class="literal">true</span>, <span class="attr">remove</span>: <span class="literal">true</span>, <span class="attr">merge</span>: <span class="literal">true</span>&#125;;</span><br><span class="line">  <span class="keyword">var</span> addOptions = &#123;<span class="attr">add</span>: <span class="literal">true</span>, <span class="attr">remove</span>: <span class="literal">false</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Splices `insert` into `array` at index `at`.</span></span><br><span class="line">  <span class="keyword">var</span> splice = <span class="function"><span class="keyword">function</span>(<span class="params">array, insert, at</span>) </span>&#123;</span><br><span class="line">    at = <span class="built_in">Math</span>.min(<span class="built_in">Math</span>.max(at, <span class="number">0</span>), array.length);</span><br><span class="line">    <span class="keyword">var</span> tail = <span class="built_in">Array</span>(array.length - at);</span><br><span class="line">    <span class="keyword">var</span> length = insert.length;</span><br><span class="line">    <span class="keyword">var</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; tail.length; i++) tail[i] = array[i + at];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; length; i++) array[i + at] = insert[i];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; tail.length; i++) array[i + length + at] = tail[i];</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Define the Collection&#x27;s inheritable methods.</span></span><br><span class="line">  _.extend(Collection.prototype, Events, &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The default model for a collection is just a **Backbone.Model**.</span></span><br><span class="line">    <span class="comment">// This should be overridden in most cases.</span></span><br><span class="line">    model: Model,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// preinitialize is an empty function by default. You can override it with a function</span></span><br><span class="line">    <span class="comment">// or object.  preinitialize will run before any instantiation logic is run in the Collection.</span></span><br><span class="line">    preinitialize: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize is an empty function by default. Override it with your own</span></span><br><span class="line">    <span class="comment">// initialization logic.</span></span><br><span class="line">    initialize: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The JSON representation of a Collection is an array of the</span></span><br><span class="line">    <span class="comment">// models&#x27; attributes.</span></span><br><span class="line">    toJSON: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params">model</span>) </span>&#123; <span class="keyword">return</span> model.toJSON(options); &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Proxy `Backbone.sync` by default.</span></span><br><span class="line">    sync: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> Backbone.sync.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add a model, or list of models to the set. `models` may be Backbone</span></span><br><span class="line">    <span class="comment">// Models or raw JavaScript objects to be converted to Models, or any</span></span><br><span class="line">    <span class="comment">// combination of the two.</span></span><br><span class="line">    add: <span class="function"><span class="keyword">function</span>(<span class="params">models, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.set(models, _.extend(&#123;<span class="attr">merge</span>: <span class="literal">false</span>&#125;, options, addOptions));</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove a model, or a list of models from the set.</span></span><br><span class="line">    remove: <span class="function"><span class="keyword">function</span>(<span class="params">models, options</span>) </span>&#123;</span><br><span class="line">      options = _.extend(&#123;&#125;, options);</span><br><span class="line">      <span class="keyword">var</span> singular = !_.isArray(models);</span><br><span class="line">      models = singular ? [models] : models.slice();</span><br><span class="line">      <span class="keyword">var</span> removed = <span class="built_in">this</span>._removeModels(models, options);</span><br><span class="line">      <span class="keyword">if</span> (!options.silent &amp;&amp; removed.length) &#123;</span><br><span class="line">        options.changes = &#123;<span class="attr">added</span>: [], <span class="attr">merged</span>: [], <span class="attr">removed</span>: removed&#125;;</span><br><span class="line">        <span class="built_in">this</span>.trigger(<span class="string">&#x27;update&#x27;</span>, <span class="built_in">this</span>, options);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> singular ? removed[<span class="number">0</span>] : removed;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update a collection by `set`-ing a new list of models, adding new ones,</span></span><br><span class="line">    <span class="comment">// removing models that are no longer present, and merging models that</span></span><br><span class="line">    <span class="comment">// already exist in the collection, as necessary. Similar to **Model#set**,</span></span><br><span class="line">    <span class="comment">// the core operation for updating the data contained by the collection.</span></span><br><span class="line">    set: <span class="function"><span class="keyword">function</span>(<span class="params">models, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (models == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      options = _.extend(&#123;&#125;, setOptions, options);</span><br><span class="line">      <span class="keyword">if</span> (options.parse &amp;&amp; !<span class="built_in">this</span>._isModel(models)) &#123;</span><br><span class="line">        models = <span class="built_in">this</span>.parse(models, options) || [];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> singular = !_.isArray(models);</span><br><span class="line">      models = singular ? [models] : models.slice();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> at = options.at;</span><br><span class="line">      <span class="keyword">if</span> (at != <span class="literal">null</span>) at = +at;</span><br><span class="line">      <span class="keyword">if</span> (at &gt; <span class="built_in">this</span>.length) at = <span class="built_in">this</span>.length;</span><br><span class="line">      <span class="keyword">if</span> (at &lt; <span class="number">0</span>) at += <span class="built_in">this</span>.length + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> set = [];</span><br><span class="line">      <span class="keyword">var</span> toAdd = [];</span><br><span class="line">      <span class="keyword">var</span> toMerge = [];</span><br><span class="line">      <span class="keyword">var</span> toRemove = [];</span><br><span class="line">      <span class="keyword">var</span> modelMap = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> add = options.add;</span><br><span class="line">      <span class="keyword">var</span> merge = options.merge;</span><br><span class="line">      <span class="keyword">var</span> remove = options.remove;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> sort = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">var</span> sortable = <span class="built_in">this</span>.comparator &amp;&amp; at == <span class="literal">null</span> &amp;&amp; options.sort !== <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">var</span> sortAttr = _.isString(<span class="built_in">this</span>.comparator) ? <span class="built_in">this</span>.comparator : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Turn bare objects into model references, and prevent invalid models</span></span><br><span class="line">      <span class="comment">// from being added.</span></span><br><span class="line">      <span class="keyword">var</span> model, i;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; models.length; i++) &#123;</span><br><span class="line">        model = models[i];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If a duplicate is found, prevent it from being added and</span></span><br><span class="line">        <span class="comment">// optionally merge it into the existing model.</span></span><br><span class="line">        <span class="keyword">var</span> existing = <span class="built_in">this</span>.get(model);</span><br><span class="line">        <span class="keyword">if</span> (existing) &#123;</span><br><span class="line">          <span class="keyword">if</span> (merge &amp;&amp; model !== existing) &#123;</span><br><span class="line">            <span class="keyword">var</span> attrs = <span class="built_in">this</span>._isModel(model) ? model.attributes : model;</span><br><span class="line">            <span class="keyword">if</span> (options.parse) attrs = existing.parse(attrs, options);</span><br><span class="line">            existing.set(attrs, options);</span><br><span class="line">            toMerge.push(existing);</span><br><span class="line">            <span class="keyword">if</span> (sortable &amp;&amp; !sort) sort = existing.hasChanged(sortAttr);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (!modelMap[existing.cid]) &#123;</span><br><span class="line">            modelMap[existing.cid] = <span class="literal">true</span>;</span><br><span class="line">            set.push(existing);</span><br><span class="line">          &#125;</span><br><span class="line">          models[i] = existing;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If this is a new, valid model, push it to the `toAdd` list.</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (add) &#123;</span><br><span class="line">          model = models[i] = <span class="built_in">this</span>._prepareModel(model, options);</span><br><span class="line">          <span class="keyword">if</span> (model) &#123;</span><br><span class="line">            toAdd.push(model);</span><br><span class="line">            <span class="built_in">this</span>._addReference(model, options);</span><br><span class="line">            modelMap[model.cid] = <span class="literal">true</span>;</span><br><span class="line">            set.push(model);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Remove stale models.</span></span><br><span class="line">      <span class="keyword">if</span> (remove) &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.length; i++) &#123;</span><br><span class="line">          model = <span class="built_in">this</span>.models[i];</span><br><span class="line">          <span class="keyword">if</span> (!modelMap[model.cid]) toRemove.push(model);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (toRemove.length) <span class="built_in">this</span>._removeModels(toRemove, options);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// See if sorting is needed, update `length` and splice in new models.</span></span><br><span class="line">      <span class="keyword">var</span> orderChanged = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">var</span> replace = !sortable &amp;&amp; add &amp;&amp; remove;</span><br><span class="line">      <span class="keyword">if</span> (set.length &amp;&amp; replace) &#123;</span><br><span class="line">        orderChanged = <span class="built_in">this</span>.length !== set.length || _.some(<span class="built_in">this</span>.models, <span class="function"><span class="keyword">function</span>(<span class="params">m, index</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> m !== set[index];</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">this</span>.models.length = <span class="number">0</span>;</span><br><span class="line">        splice(<span class="built_in">this</span>.models, set, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">this</span>.length = <span class="built_in">this</span>.models.length;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (toAdd.length) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sortable) sort = <span class="literal">true</span>;</span><br><span class="line">        splice(<span class="built_in">this</span>.models, toAdd, at == <span class="literal">null</span> ? <span class="built_in">this</span>.length : at);</span><br><span class="line">        <span class="built_in">this</span>.length = <span class="built_in">this</span>.models.length;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Silently sort the collection if appropriate.</span></span><br><span class="line">      <span class="keyword">if</span> (sort) <span class="built_in">this</span>.sort(&#123;<span class="attr">silent</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Unless silenced, it&#x27;s time to fire all appropriate add/sort/update events.</span></span><br><span class="line">      <span class="keyword">if</span> (!options.silent) &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; toAdd.length; i++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (at != <span class="literal">null</span>) options.index = at + i;</span><br><span class="line">          model = toAdd[i];</span><br><span class="line">          model.trigger(<span class="string">&#x27;add&#x27;</span>, model, <span class="built_in">this</span>, options);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sort || orderChanged) <span class="built_in">this</span>.trigger(<span class="string">&#x27;sort&#x27;</span>, <span class="built_in">this</span>, options);</span><br><span class="line">        <span class="keyword">if</span> (toAdd.length || toRemove.length || toMerge.length) &#123;</span><br><span class="line">          options.changes = &#123;</span><br><span class="line">            added: toAdd,</span><br><span class="line">            removed: toRemove,</span><br><span class="line">            merged: toMerge</span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="built_in">this</span>.trigger(<span class="string">&#x27;update&#x27;</span>, <span class="built_in">this</span>, options);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Return the added (or merged) model (or models).</span></span><br><span class="line">      <span class="keyword">return</span> singular ? models[<span class="number">0</span>] : models;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When you have more items than you want to add or remove individually,</span></span><br><span class="line">    <span class="comment">// you can reset the entire set with a new list of models, without firing</span></span><br><span class="line">    <span class="comment">// any granular `add` or `remove` events. Fires `reset` when finished.</span></span><br><span class="line">    <span class="comment">// Useful for bulk operations and optimizations.</span></span><br><span class="line">    reset: <span class="function"><span class="keyword">function</span>(<span class="params">models, options</span>) </span>&#123;</span><br><span class="line">      options = options ? _.clone(options) : &#123;&#125;;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.models.length; i++) &#123;</span><br><span class="line">        <span class="built_in">this</span>._removeReference(<span class="built_in">this</span>.models[i], options);</span><br><span class="line">      &#125;</span><br><span class="line">      options.previousModels = <span class="built_in">this</span>.models;</span><br><span class="line">      <span class="built_in">this</span>._reset();</span><br><span class="line">      models = <span class="built_in">this</span>.add(models, _.extend(&#123;<span class="attr">silent</span>: <span class="literal">true</span>&#125;, options));</span><br><span class="line">      <span class="keyword">if</span> (!options.silent) <span class="built_in">this</span>.trigger(<span class="string">&#x27;reset&#x27;</span>, <span class="built_in">this</span>, options);</span><br><span class="line">      <span class="keyword">return</span> models;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add a model to the end of the collection.</span></span><br><span class="line">    push: <span class="function"><span class="keyword">function</span>(<span class="params">model, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.add(model, _.extend(&#123;<span class="attr">at</span>: <span class="built_in">this</span>.length&#125;, options));</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove a model from the end of the collection.</span></span><br><span class="line">    pop: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> model = <span class="built_in">this</span>.at(<span class="built_in">this</span>.length - <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.remove(model, options);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add a model to the beginning of the collection.</span></span><br><span class="line">    unshift: <span class="function"><span class="keyword">function</span>(<span class="params">model, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.add(model, _.extend(&#123;<span class="attr">at</span>: <span class="number">0</span>&#125;, options));</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove a model from the beginning of the collection.</span></span><br><span class="line">    shift: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> model = <span class="built_in">this</span>.at(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.remove(model, options);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Slice out a sub-array of models from the collection.</span></span><br><span class="line">    slice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> slice.apply(<span class="built_in">this</span>.models, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get a model from the set by id, cid, model object with id or cid</span></span><br><span class="line">    <span class="comment">// properties, or an attributes object that is transformed through modelId.</span></span><br><span class="line">    get: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (obj == <span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>._byId[obj] ||</span><br><span class="line">        <span class="built_in">this</span>._byId[<span class="built_in">this</span>.modelId(<span class="built_in">this</span>._isModel(obj) ? obj.attributes : obj)] ||</span><br><span class="line">        obj.cid &amp;&amp; <span class="built_in">this</span>._byId[obj.cid];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Returns `true` if the model is in the collection.</span></span><br><span class="line">    has: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.get(obj) != <span class="literal">null</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the model at the given index.</span></span><br><span class="line">    at: <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (index &lt; <span class="number">0</span>) index += <span class="built_in">this</span>.length;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.models[index];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return models with matching attributes. Useful for simple cases of</span></span><br><span class="line">    <span class="comment">// `filter`.</span></span><br><span class="line">    where: <span class="function"><span class="keyword">function</span>(<span class="params">attrs, first</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>[first ? <span class="string">&#x27;find&#x27;</span> : <span class="string">&#x27;filter&#x27;</span>](attrs);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return the first model with matching attributes. Useful for simple cases</span></span><br><span class="line">    <span class="comment">// of `find`.</span></span><br><span class="line">    findWhere: <span class="function"><span class="keyword">function</span>(<span class="params">attrs</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.where(attrs, <span class="literal">true</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Force the collection to re-sort itself. You don&#x27;t need to call this under</span></span><br><span class="line">    <span class="comment">// normal circumstances, as the set will maintain sort order as each item</span></span><br><span class="line">    <span class="comment">// is added.</span></span><br><span class="line">    sort: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> comparator = <span class="built_in">this</span>.comparator;</span><br><span class="line">      <span class="keyword">if</span> (!comparator) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Cannot sort a set without a comparator&#x27;</span>);</span><br><span class="line">      options || (options = &#123;&#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> length = comparator.length;</span><br><span class="line">      <span class="keyword">if</span> (_.isFunction(comparator)) comparator = comparator.bind(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Run sort based on type of `comparator`.</span></span><br><span class="line">      <span class="keyword">if</span> (length === <span class="number">1</span> || _.isString(comparator)) &#123;</span><br><span class="line">        <span class="built_in">this</span>.models = <span class="built_in">this</span>.sortBy(comparator);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.models.sort(comparator);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!options.silent) <span class="built_in">this</span>.trigger(<span class="string">&#x27;sort&#x27;</span>, <span class="built_in">this</span>, options);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Pluck an attribute from each model in the collection.</span></span><br><span class="line">    pluck: <span class="function"><span class="keyword">function</span>(<span class="params">attr</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.map(attr + <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fetch the default set of models for this collection, resetting the</span></span><br><span class="line">    <span class="comment">// collection when they arrive. If `reset: true` is passed, the response</span></span><br><span class="line">    <span class="comment">// data will be passed through the `reset` method instead of `set`.</span></span><br><span class="line">    fetch: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      options = _.extend(&#123;<span class="attr">parse</span>: <span class="literal">true</span>&#125;, options);</span><br><span class="line">      <span class="keyword">var</span> success = options.success;</span><br><span class="line">      <span class="keyword">var</span> collection = <span class="built_in">this</span>;</span><br><span class="line">      options.success = <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> method = options.reset ? <span class="string">&#x27;reset&#x27;</span> : <span class="string">&#x27;set&#x27;</span>;</span><br><span class="line">        collection[method](resp, options);</span><br><span class="line">        <span class="keyword">if</span> (success) success.call(options.context, collection, resp, options);</span><br><span class="line">        collection.trigger(<span class="string">&#x27;sync&#x27;</span>, collection, resp, options);</span><br><span class="line">      &#125;;</span><br><span class="line">      wrapError(<span class="built_in">this</span>, options);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.sync(<span class="string">&#x27;read&#x27;</span>, <span class="built_in">this</span>, options);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a new instance of a model in this collection. Add the model to the</span></span><br><span class="line">    <span class="comment">// collection immediately, unless `wait: true` is passed, in which case we</span></span><br><span class="line">    <span class="comment">// wait for the server to agree.</span></span><br><span class="line">    create: <span class="function"><span class="keyword">function</span>(<span class="params">model, options</span>) </span>&#123;</span><br><span class="line">      options = options ? _.clone(options) : &#123;&#125;;</span><br><span class="line">      <span class="keyword">var</span> wait = options.wait;</span><br><span class="line">      model = <span class="built_in">this</span>._prepareModel(model, options);</span><br><span class="line">      <span class="keyword">if</span> (!model) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (!wait) <span class="built_in">this</span>.add(model, options);</span><br><span class="line">      <span class="keyword">var</span> collection = <span class="built_in">this</span>;</span><br><span class="line">      <span class="keyword">var</span> success = options.success;</span><br><span class="line">      options.success = <span class="function"><span class="keyword">function</span>(<span class="params">m, resp, callbackOpts</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (wait) collection.add(m, callbackOpts);</span><br><span class="line">        <span class="keyword">if</span> (success) success.call(callbackOpts.context, m, resp, callbackOpts);</span><br><span class="line">      &#125;;</span><br><span class="line">      model.save(<span class="literal">null</span>, options);</span><br><span class="line">      <span class="keyword">return</span> model;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// **parse** converts a response into a list of models to be added to the</span></span><br><span class="line">    <span class="comment">// collection. The default implementation is just to pass it through.</span></span><br><span class="line">    parse: <span class="function"><span class="keyword">function</span>(<span class="params">resp, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> resp;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a new collection with an identical list of models as this one.</span></span><br><span class="line">    clone: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">this</span>.constructor(<span class="built_in">this</span>.models, &#123;</span><br><span class="line">        model: <span class="built_in">this</span>.model,</span><br><span class="line">        comparator: <span class="built_in">this</span>.comparator</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Define how to uniquely identify models in the collection.</span></span><br><span class="line">    modelId: <span class="function"><span class="keyword">function</span>(<span class="params">attrs</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> attrs[<span class="built_in">this</span>.model.prototype.idAttribute || <span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get an iterator of all models in this collection.</span></span><br><span class="line">    values: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> CollectionIterator(<span class="built_in">this</span>, ITERATOR_VALUES);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get an iterator of all model IDs in this collection.</span></span><br><span class="line">    keys: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> CollectionIterator(<span class="built_in">this</span>, ITERATOR_KEYS);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get an iterator of all [ID, model] tuples in this collection.</span></span><br><span class="line">    entries: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> CollectionIterator(<span class="built_in">this</span>, ITERATOR_KEYSVALUES);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Private method to reset all internal state. Called when the collection</span></span><br><span class="line">    <span class="comment">// is first initialized or reset.</span></span><br><span class="line">    _reset: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.length = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">this</span>.models = [];</span><br><span class="line">      <span class="built_in">this</span>._byId  = &#123;&#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Prepare a hash of attributes (or other model) to be added to this</span></span><br><span class="line">    <span class="comment">// collection.</span></span><br><span class="line">    _prepareModel: <span class="function"><span class="keyword">function</span>(<span class="params">attrs, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>._isModel(attrs)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!attrs.collection) attrs.collection = <span class="built_in">this</span>;</span><br><span class="line">        <span class="keyword">return</span> attrs;</span><br><span class="line">      &#125;</span><br><span class="line">      options = options ? _.clone(options) : &#123;&#125;;</span><br><span class="line">      options.collection = <span class="built_in">this</span>;</span><br><span class="line">      <span class="keyword">var</span> model = <span class="keyword">new</span> <span class="built_in">this</span>.model(attrs, options);</span><br><span class="line">      <span class="keyword">if</span> (!model.validationError) <span class="keyword">return</span> model;</span><br><span class="line">      <span class="built_in">this</span>.trigger(<span class="string">&#x27;invalid&#x27;</span>, <span class="built_in">this</span>, model.validationError, options);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Internal method called by both remove and set.</span></span><br><span class="line">    _removeModels: <span class="function"><span class="keyword">function</span>(<span class="params">models, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> removed = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; models.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> model = <span class="built_in">this</span>.get(models[i]);</span><br><span class="line">        <span class="keyword">if</span> (!model) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> index = <span class="built_in">this</span>.indexOf(model);</span><br><span class="line">        <span class="built_in">this</span>.models.splice(index, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">this</span>.length--;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Remove references before triggering &#x27;remove&#x27; event to prevent an</span></span><br><span class="line">        <span class="comment">// infinite loop. #3693</span></span><br><span class="line">        <span class="keyword">delete</span> <span class="built_in">this</span>._byId[model.cid];</span><br><span class="line">        <span class="keyword">var</span> id = <span class="built_in">this</span>.modelId(model.attributes);</span><br><span class="line">        <span class="keyword">if</span> (id != <span class="literal">null</span>) <span class="keyword">delete</span> <span class="built_in">this</span>._byId[id];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!options.silent) &#123;</span><br><span class="line">          options.index = index;</span><br><span class="line">          model.trigger(<span class="string">&#x27;remove&#x27;</span>, model, <span class="built_in">this</span>, options);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        removed.push(model);</span><br><span class="line">        <span class="built_in">this</span>._removeReference(model, options);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> removed;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Method for checking whether an object should be considered a model for</span></span><br><span class="line">    <span class="comment">// the purposes of adding to the collection.</span></span><br><span class="line">    _isModel: <span class="function"><span class="keyword">function</span>(<span class="params">model</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> model <span class="keyword">instanceof</span> Model;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Internal method to create a model&#x27;s ties to a collection.</span></span><br><span class="line">    _addReference: <span class="function"><span class="keyword">function</span>(<span class="params">model, options</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>._byId[model.cid] = model;</span><br><span class="line">      <span class="keyword">var</span> id = <span class="built_in">this</span>.modelId(model.attributes);</span><br><span class="line">      <span class="keyword">if</span> (id != <span class="literal">null</span>) <span class="built_in">this</span>._byId[id] = model;</span><br><span class="line">      model.on(<span class="string">&#x27;all&#x27;</span>, <span class="built_in">this</span>._onModelEvent, <span class="built_in">this</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Internal method to sever a model&#x27;s ties to a collection.</span></span><br><span class="line">    _removeReference: <span class="function"><span class="keyword">function</span>(<span class="params">model, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">delete</span> <span class="built_in">this</span>._byId[model.cid];</span><br><span class="line">      <span class="keyword">var</span> id = <span class="built_in">this</span>.modelId(model.attributes);</span><br><span class="line">      <span class="keyword">if</span> (id != <span class="literal">null</span>) <span class="keyword">delete</span> <span class="built_in">this</span>._byId[id];</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span> === model.collection) <span class="keyword">delete</span> model.collection;</span><br><span class="line">      model.off(<span class="string">&#x27;all&#x27;</span>, <span class="built_in">this</span>._onModelEvent, <span class="built_in">this</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Internal method called every time a model in the set fires an event.</span></span><br><span class="line">    <span class="comment">// Sets need to update their indexes when models change ids. All other</span></span><br><span class="line">    <span class="comment">// events simply proxy through. &quot;add&quot; and &quot;remove&quot; events that originate</span></span><br><span class="line">    <span class="comment">// in other collections are ignored.</span></span><br><span class="line">    _onModelEvent: <span class="function"><span class="keyword">function</span>(<span class="params">event, model, collection, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (model) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((event === <span class="string">&#x27;add&#x27;</span> || event === <span class="string">&#x27;remove&#x27;</span>) &amp;&amp; collection !== <span class="built_in">this</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (event === <span class="string">&#x27;destroy&#x27;</span>) <span class="built_in">this</span>.remove(model, options);</span><br><span class="line">        <span class="keyword">if</span> (event === <span class="string">&#x27;change&#x27;</span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> prevId = <span class="built_in">this</span>.modelId(model.previousAttributes());</span><br><span class="line">          <span class="keyword">var</span> id = <span class="built_in">this</span>.modelId(model.attributes);</span><br><span class="line">          <span class="keyword">if</span> (prevId !== id) &#123;</span><br><span class="line">            <span class="keyword">if</span> (prevId != <span class="literal">null</span>) <span class="keyword">delete</span> <span class="built_in">this</span>._byId[prevId];</span><br><span class="line">            <span class="keyword">if</span> (id != <span class="literal">null</span>) <span class="built_in">this</span>._byId[id] = model;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.trigger.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Defining an @@iterator method implements JavaScript&#x27;s Iterable protocol.</span></span><br><span class="line">  <span class="comment">// In modern ES2015 browsers, this value is found at Symbol.iterator.</span></span><br><span class="line">  <span class="comment">/* global Symbol */</span></span><br><span class="line">  <span class="keyword">var</span> $$iterator = <span class="keyword">typeof</span> <span class="built_in">Symbol</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; <span class="built_in">Symbol</span>.iterator;</span><br><span class="line">  <span class="keyword">if</span> ($$iterator) &#123;</span><br><span class="line">    Collection.prototype[$$iterator] = Collection.prototype.values;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// CollectionIterator</span></span><br><span class="line">  <span class="comment">// ------------------</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A CollectionIterator implements JavaScript&#x27;s Iterator protocol, allowing the</span></span><br><span class="line">  <span class="comment">// use of `for of` loops in modern browsers and interoperation between</span></span><br><span class="line">  <span class="comment">// Backbone.Collection and other JavaScript functions and third-party libraries</span></span><br><span class="line">  <span class="comment">// which can operate on Iterables.</span></span><br><span class="line">  <span class="keyword">var</span> CollectionIterator = <span class="function"><span class="keyword">function</span>(<span class="params">collection, kind</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>._collection = collection;</span><br><span class="line">    <span class="built_in">this</span>._kind = kind;</span><br><span class="line">    <span class="built_in">this</span>._index = <span class="number">0</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This &quot;enum&quot; defines the three possible kinds of values which can be emitted</span></span><br><span class="line">  <span class="comment">// by a CollectionIterator that correspond to the values(), keys() and entries()</span></span><br><span class="line">  <span class="comment">// methods on Collection, respectively.</span></span><br><span class="line">  <span class="keyword">var</span> ITERATOR_VALUES = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">var</span> ITERATOR_KEYS = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">var</span> ITERATOR_KEYSVALUES = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// All Iterators should themselves be Iterable.</span></span><br><span class="line">  <span class="keyword">if</span> ($$iterator) &#123;</span><br><span class="line">    CollectionIterator.prototype[$$iterator] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  CollectionIterator.prototype.next = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._collection) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Only continue iterating if the iterated collection is long enough.</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>._index &lt; <span class="built_in">this</span>._collection.length) &#123;</span><br><span class="line">        <span class="keyword">var</span> model = <span class="built_in">this</span>._collection.at(<span class="built_in">this</span>._index);</span><br><span class="line">        <span class="built_in">this</span>._index++;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Construct a value depending on what kind of values should be iterated.</span></span><br><span class="line">        <span class="keyword">var</span> value;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>._kind === ITERATOR_VALUES) &#123;</span><br><span class="line">          value = model;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> id = <span class="built_in">this</span>._collection.modelId(model.attributes);</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>._kind === ITERATOR_KEYS) &#123;</span><br><span class="line">            value = id;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123; <span class="comment">// ITERATOR_KEYSVALUES</span></span><br><span class="line">            value = [id, model];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">value</span>: value, <span class="attr">done</span>: <span class="literal">false</span>&#125;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Once exhausted, remove the reference to the collection so future</span></span><br><span class="line">      <span class="comment">// calls to the next method always return done.</span></span><br><span class="line">      <span class="built_in">this</span>._collection = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">value</span>: <span class="keyword">void</span> <span class="number">0</span>, <span class="attr">done</span>: <span class="literal">true</span>&#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Backbone.View</span></span><br><span class="line">  <span class="comment">// -------------</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Backbone Views are almost more convention than they are actual code. A View</span></span><br><span class="line">  <span class="comment">// is simply a JavaScript object that represents a logical chunk of UI in the</span></span><br><span class="line">  <span class="comment">// DOM. This might be a single item, an entire list, a sidebar or panel, or</span></span><br><span class="line">  <span class="comment">// even the surrounding frame which wraps your whole app. Defining a chunk of</span></span><br><span class="line">  <span class="comment">// UI as a **View** allows you to define your DOM events declaratively, without</span></span><br><span class="line">  <span class="comment">// having to worry about render order ... and makes it easy for the view to</span></span><br><span class="line">  <span class="comment">// react to specific changes in the state of your models.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Creating a Backbone.View creates its initial element outside of the DOM,</span></span><br><span class="line">  <span class="comment">// if an existing element is not provided...</span></span><br><span class="line">  <span class="keyword">var</span> View = Backbone.View = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.cid = _.uniqueId(<span class="string">&#x27;view&#x27;</span>);</span><br><span class="line">    <span class="built_in">this</span>.preinitialize.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    _.extend(<span class="built_in">this</span>, _.pick(options, viewOptions));</span><br><span class="line">    <span class="built_in">this</span>._ensureElement();</span><br><span class="line">    <span class="built_in">this</span>.initialize.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Cached regex to split keys for `delegate`.</span></span><br><span class="line">  <span class="keyword">var</span> delegateEventSplitter = <span class="regexp">/^(\S+)\s*(.*)$/</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// List of view options to be set as properties.</span></span><br><span class="line">  <span class="keyword">var</span> viewOptions = [<span class="string">&#x27;model&#x27;</span>, <span class="string">&#x27;collection&#x27;</span>, <span class="string">&#x27;el&#x27;</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;attributes&#x27;</span>, <span class="string">&#x27;className&#x27;</span>, <span class="string">&#x27;tagName&#x27;</span>, <span class="string">&#x27;events&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set up all inheritable **Backbone.View** properties and methods.</span></span><br><span class="line">  _.extend(View.prototype, Events, &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The default `tagName` of a View&#x27;s element is `&quot;div&quot;`.</span></span><br><span class="line">    tagName: <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// jQuery delegate for element lookup, scoped to DOM elements within the</span></span><br><span class="line">    <span class="comment">// current view. This should be preferred to global lookups where possible.</span></span><br><span class="line">    $: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.$el.find(selector);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// preinitialize is an empty function by default. You can override it with a function</span></span><br><span class="line">    <span class="comment">// or object.  preinitialize will run before any instantiation logic is run in the View</span></span><br><span class="line">    preinitialize: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize is an empty function by default. Override it with your own</span></span><br><span class="line">    <span class="comment">// initialization logic.</span></span><br><span class="line">    initialize: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// **render** is the core function that your view should override, in order</span></span><br><span class="line">    <span class="comment">// to populate its element (`this.el`), with the appropriate HTML. The</span></span><br><span class="line">    <span class="comment">// convention is for **render** to always return `this`.</span></span><br><span class="line">    render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove this view by taking the element out of the DOM, and removing any</span></span><br><span class="line">    <span class="comment">// applicable Backbone.Events listeners.</span></span><br><span class="line">    remove: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>._removeElement();</span><br><span class="line">      <span class="built_in">this</span>.stopListening();</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove this view&#x27;s element from the document and all event listeners</span></span><br><span class="line">    <span class="comment">// attached to it. Exposed for subclasses using an alternative DOM</span></span><br><span class="line">    <span class="comment">// manipulation API.</span></span><br><span class="line">    _removeElement: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.$el.remove();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Change the view&#x27;s element (`this.el` property) and re-delegate the</span></span><br><span class="line">    <span class="comment">// view&#x27;s events on the new element.</span></span><br><span class="line">    setElement: <span class="function"><span class="keyword">function</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.undelegateEvents();</span><br><span class="line">      <span class="built_in">this</span>._setElement(element);</span><br><span class="line">      <span class="built_in">this</span>.delegateEvents();</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Creates the `this.el` and `this.$el` references for this view using the</span></span><br><span class="line">    <span class="comment">// given `el`. `el` can be a CSS selector or an HTML string, a jQuery</span></span><br><span class="line">    <span class="comment">// context or an element. Subclasses can override this to utilize an</span></span><br><span class="line">    <span class="comment">// alternative DOM manipulation API and are only required to set the</span></span><br><span class="line">    <span class="comment">// `this.el` property.</span></span><br><span class="line">    _setElement: <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.$el = el <span class="keyword">instanceof</span> Backbone.$ ? el : Backbone.$(el);</span><br><span class="line">      <span class="built_in">this</span>.el = <span class="built_in">this</span>.$el[<span class="number">0</span>];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set callbacks, where `this.events` is a hash of</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// *&#123;&quot;event selector&quot;: &quot;callback&quot;&#125;*</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//     &#123;</span></span><br><span class="line">    <span class="comment">//       &#x27;mousedown .title&#x27;:  &#x27;edit&#x27;,</span></span><br><span class="line">    <span class="comment">//       &#x27;click .button&#x27;:     &#x27;save&#x27;,</span></span><br><span class="line">    <span class="comment">//       &#x27;click .open&#x27;:       function(e) &#123; ... &#125;</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// pairs. Callbacks will be bound to the view, with `this` set properly.</span></span><br><span class="line">    <span class="comment">// Uses event delegation for efficiency.</span></span><br><span class="line">    <span class="comment">// Omitting the selector binds the event to `this.el`.</span></span><br><span class="line">    delegateEvents: <span class="function"><span class="keyword">function</span>(<span class="params">events</span>) </span>&#123;</span><br><span class="line">      events || (events = _.result(<span class="built_in">this</span>, <span class="string">&#x27;events&#x27;</span>));</span><br><span class="line">      <span class="keyword">if</span> (!events) <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">      <span class="built_in">this</span>.undelegateEvents();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> events) &#123;</span><br><span class="line">        <span class="keyword">var</span> method = events[key];</span><br><span class="line">        <span class="keyword">if</span> (!_.isFunction(method)) method = <span class="built_in">this</span>[method];</span><br><span class="line">        <span class="keyword">if</span> (!method) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">var</span> match = key.match(delegateEventSplitter);</span><br><span class="line">        <span class="built_in">this</span>.delegate(match[<span class="number">1</span>], match[<span class="number">2</span>], method.bind(<span class="built_in">this</span>));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add a single event listener to the view&#x27;s element (or a child element</span></span><br><span class="line">    <span class="comment">// using `selector`). This only works for delegate-able events: not `focus`,</span></span><br><span class="line">    <span class="comment">// `blur`, and not `change`, `submit`, and `reset` in Internet Explorer.</span></span><br><span class="line">    delegate: <span class="function"><span class="keyword">function</span>(<span class="params">eventName, selector, listener</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.$el.on(eventName + <span class="string">&#x27;.delegateEvents&#x27;</span> + <span class="built_in">this</span>.cid, selector, listener);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Clears all callbacks previously bound to the view by `delegateEvents`.</span></span><br><span class="line">    <span class="comment">// You usually don&#x27;t need to use this, but may wish to if you have multiple</span></span><br><span class="line">    <span class="comment">// Backbone views attached to the same DOM element.</span></span><br><span class="line">    undelegateEvents: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.$el) <span class="built_in">this</span>.$el.off(<span class="string">&#x27;.delegateEvents&#x27;</span> + <span class="built_in">this</span>.cid);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A finer-grained `undelegateEvents` for removing a single delegated event.</span></span><br><span class="line">    <span class="comment">// `selector` and `listener` are both optional.</span></span><br><span class="line">    undelegate: <span class="function"><span class="keyword">function</span>(<span class="params">eventName, selector, listener</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.$el.off(eventName + <span class="string">&#x27;.delegateEvents&#x27;</span> + <span class="built_in">this</span>.cid, selector, listener);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Produces a DOM element to be assigned to your view. Exposed for</span></span><br><span class="line">    <span class="comment">// subclasses using an alternative DOM manipulation API.</span></span><br><span class="line">    _createElement: <span class="function"><span class="keyword">function</span>(<span class="params">tagName</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">document</span>.createElement(tagName);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ensure that the View has a DOM element to render into.</span></span><br><span class="line">    <span class="comment">// If `this.el` is a string, pass it through `$()`, take the first</span></span><br><span class="line">    <span class="comment">// matching element, and re-assign it to `el`. Otherwise, create</span></span><br><span class="line">    <span class="comment">// an element from the `id`, `className` and `tagName` properties.</span></span><br><span class="line">    _ensureElement: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">this</span>.el) &#123;</span><br><span class="line">        <span class="keyword">var</span> attrs = _.extend(&#123;&#125;, _.result(<span class="built_in">this</span>, <span class="string">&#x27;attributes&#x27;</span>));</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.id) attrs.id = _.result(<span class="built_in">this</span>, <span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.className) attrs[<span class="string">&#x27;class&#x27;</span>] = _.result(<span class="built_in">this</span>, <span class="string">&#x27;className&#x27;</span>);</span><br><span class="line">        <span class="built_in">this</span>.setElement(<span class="built_in">this</span>._createElement(_.result(<span class="built_in">this</span>, <span class="string">&#x27;tagName&#x27;</span>)));</span><br><span class="line">        <span class="built_in">this</span>._setAttributes(attrs);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setElement(_.result(<span class="built_in">this</span>, <span class="string">&#x27;el&#x27;</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set attributes from a hash on this view&#x27;s element.  Exposed for</span></span><br><span class="line">    <span class="comment">// subclasses using an alternative DOM manipulation API.</span></span><br><span class="line">    _setAttributes: <span class="function"><span class="keyword">function</span>(<span class="params">attributes</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.$el.attr(attributes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Proxy Backbone class methods to Underscore functions, wrapping the model&#x27;s</span></span><br><span class="line">  <span class="comment">// `attributes` object or collection&#x27;s `models` array behind the scenes.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// collection.filter(function(model) &#123; return model.get(&#x27;age&#x27;) &gt; 10 &#125;);</span></span><br><span class="line">  <span class="comment">// collection.each(this.addView);</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// `Function#apply` can be slow so we use the method&#x27;s arg count, if we know it.</span></span><br><span class="line">  <span class="keyword">var</span> addMethod = <span class="function"><span class="keyword">function</span>(<span class="params">base, length, method, attribute</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (length) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> base[method](<span class="built_in">this</span>[attribute]);</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> base[method](<span class="built_in">this</span>[attribute], value);</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>: <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">iteratee, context</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> base[method](<span class="built_in">this</span>[attribute], cb(iteratee, <span class="built_in">this</span>), context);</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>: <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">iteratee, defaultVal, context</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> base[method](<span class="built_in">this</span>[attribute], cb(iteratee, <span class="built_in">this</span>), defaultVal, context);</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">default</span>: <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> args = slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">        args.unshift(<span class="built_in">this</span>[attribute]);</span><br><span class="line">        <span class="keyword">return</span> base[method].apply(base, args);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> addUnderscoreMethods = <span class="function"><span class="keyword">function</span>(<span class="params">Class, base, methods, attribute</span>) </span>&#123;</span><br><span class="line">    _.each(methods, <span class="function"><span class="keyword">function</span>(<span class="params">length, method</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (base[method]) Class.prototype[method] = addMethod(base, length, method, attribute);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Support `collection.sortBy(&#x27;attr&#x27;)` and `collection.findWhere(&#123;id: 1&#125;)`.</span></span><br><span class="line">  <span class="keyword">var</span> cb = <span class="function"><span class="keyword">function</span>(<span class="params">iteratee, instance</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_.isFunction(iteratee)) <span class="keyword">return</span> iteratee;</span><br><span class="line">    <span class="keyword">if</span> (_.isObject(iteratee) &amp;&amp; !instance._isModel(iteratee)) <span class="keyword">return</span> modelMatcher(iteratee);</span><br><span class="line">    <span class="keyword">if</span> (_.isString(iteratee)) <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">model</span>) </span>&#123; <span class="keyword">return</span> model.get(iteratee); &#125;;</span><br><span class="line">    <span class="keyword">return</span> iteratee;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> modelMatcher = <span class="function"><span class="keyword">function</span>(<span class="params">attrs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> matcher = _.matches(attrs);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">model</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> matcher(model.attributes);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Underscore methods that we want to implement on the Collection.</span></span><br><span class="line">  <span class="comment">// 90% of the core usefulness of Backbone Collections is actually implemented</span></span><br><span class="line">  <span class="comment">// right here:</span></span><br><span class="line">  <span class="keyword">var</span> collectionMethods = &#123;<span class="attr">forEach</span>: <span class="number">3</span>, <span class="attr">each</span>: <span class="number">3</span>, <span class="attr">map</span>: <span class="number">3</span>, <span class="attr">collect</span>: <span class="number">3</span>, <span class="attr">reduce</span>: <span class="number">0</span>,</span><br><span class="line">    foldl: <span class="number">0</span>, <span class="attr">inject</span>: <span class="number">0</span>, <span class="attr">reduceRight</span>: <span class="number">0</span>, <span class="attr">foldr</span>: <span class="number">0</span>, <span class="attr">find</span>: <span class="number">3</span>, <span class="attr">detect</span>: <span class="number">3</span>, <span class="attr">filter</span>: <span class="number">3</span>,</span><br><span class="line">    select: <span class="number">3</span>, <span class="attr">reject</span>: <span class="number">3</span>, <span class="attr">every</span>: <span class="number">3</span>, <span class="attr">all</span>: <span class="number">3</span>, <span class="attr">some</span>: <span class="number">3</span>, <span class="attr">any</span>: <span class="number">3</span>, <span class="attr">include</span>: <span class="number">3</span>, <span class="attr">includes</span>: <span class="number">3</span>,</span><br><span class="line">    contains: <span class="number">3</span>, <span class="attr">invoke</span>: <span class="number">0</span>, <span class="attr">max</span>: <span class="number">3</span>, <span class="attr">min</span>: <span class="number">3</span>, <span class="attr">toArray</span>: <span class="number">1</span>, <span class="attr">size</span>: <span class="number">1</span>, <span class="attr">first</span>: <span class="number">3</span>,</span><br><span class="line">    head: <span class="number">3</span>, <span class="attr">take</span>: <span class="number">3</span>, <span class="attr">initial</span>: <span class="number">3</span>, <span class="attr">rest</span>: <span class="number">3</span>, <span class="attr">tail</span>: <span class="number">3</span>, <span class="attr">drop</span>: <span class="number">3</span>, <span class="attr">last</span>: <span class="number">3</span>,</span><br><span class="line">    without: <span class="number">0</span>, <span class="attr">difference</span>: <span class="number">0</span>, <span class="attr">indexOf</span>: <span class="number">3</span>, <span class="attr">shuffle</span>: <span class="number">1</span>, <span class="attr">lastIndexOf</span>: <span class="number">3</span>,</span><br><span class="line">    isEmpty: <span class="number">1</span>, <span class="attr">chain</span>: <span class="number">1</span>, <span class="attr">sample</span>: <span class="number">3</span>, <span class="attr">partition</span>: <span class="number">3</span>, <span class="attr">groupBy</span>: <span class="number">3</span>, <span class="attr">countBy</span>: <span class="number">3</span>,</span><br><span class="line">    sortBy: <span class="number">3</span>, <span class="attr">indexBy</span>: <span class="number">3</span>, <span class="attr">findIndex</span>: <span class="number">3</span>, <span class="attr">findLastIndex</span>: <span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Underscore methods that we want to implement on the Model, mapped to the</span></span><br><span class="line">  <span class="comment">// number of arguments they take.</span></span><br><span class="line">  <span class="keyword">var</span> modelMethods = &#123;<span class="attr">keys</span>: <span class="number">1</span>, <span class="attr">values</span>: <span class="number">1</span>, <span class="attr">pairs</span>: <span class="number">1</span>, <span class="attr">invert</span>: <span class="number">1</span>, <span class="attr">pick</span>: <span class="number">0</span>,</span><br><span class="line">    omit: <span class="number">0</span>, <span class="attr">chain</span>: <span class="number">1</span>, <span class="attr">isEmpty</span>: <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Mix in each Underscore method as a proxy to `Collection#models`.</span></span><br><span class="line"></span><br><span class="line">  _.each([</span><br><span class="line">    [Collection, collectionMethods, <span class="string">&#x27;models&#x27;</span>],</span><br><span class="line">    [Model, modelMethods, <span class="string">&#x27;attributes&#x27;</span>]</span><br><span class="line">  ], <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Base = config[<span class="number">0</span>],</span><br><span class="line">        methods = config[<span class="number">1</span>],</span><br><span class="line">        attribute = config[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    Base.mixin = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> mappings = _.reduce(_.functions(obj), <span class="function"><span class="keyword">function</span>(<span class="params">memo, name</span>) </span>&#123;</span><br><span class="line">        memo[name] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> memo;</span><br><span class="line">      &#125;, &#123;&#125;);</span><br><span class="line">      addUnderscoreMethods(Base, obj, mappings, attribute);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    addUnderscoreMethods(Base, _, methods, attribute);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Backbone.sync</span></span><br><span class="line">  <span class="comment">// -------------</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Override this function to change the manner in which Backbone persists</span></span><br><span class="line">  <span class="comment">// models to the server. You will be passed the type of request, and the</span></span><br><span class="line">  <span class="comment">// model in question. By default, makes a RESTful Ajax request</span></span><br><span class="line">  <span class="comment">// to the model&#x27;s `url()`. Some possible customizations could be:</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// * Use `setTimeout` to batch rapid-fire updates into a single request.</span></span><br><span class="line">  <span class="comment">// * Send up the models as XML instead of JSON.</span></span><br><span class="line">  <span class="comment">// * Persist models via WebSockets instead of Ajax.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Turn on `Backbone.emulateHTTP` in order to send `PUT` and `DELETE` requests</span></span><br><span class="line">  <span class="comment">// as `POST`, with a `_method` parameter containing the true HTTP method,</span></span><br><span class="line">  <span class="comment">// as well as all requests with the body as `application/x-www-form-urlencoded`</span></span><br><span class="line">  <span class="comment">// instead of `application/json` with the model in a param named `model`.</span></span><br><span class="line">  <span class="comment">// Useful when interfacing with server-side languages like **PHP** that make</span></span><br><span class="line">  <span class="comment">// it difficult to read the body of `PUT` requests.</span></span><br><span class="line">  Backbone.sync = <span class="function"><span class="keyword">function</span>(<span class="params">method, model, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> type = methodMap[method];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Default options, unless specified.</span></span><br><span class="line">    _.defaults(options || (options = &#123;&#125;), &#123;</span><br><span class="line">      emulateHTTP: Backbone.emulateHTTP,</span><br><span class="line">      emulateJSON: Backbone.emulateJSON</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Default JSON-request options.</span></span><br><span class="line">    <span class="keyword">var</span> params = &#123;<span class="attr">type</span>: type, <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ensure that we have a URL.</span></span><br><span class="line">    <span class="keyword">if</span> (!options.url) &#123;</span><br><span class="line">      params.url = _.result(model, <span class="string">&#x27;url&#x27;</span>) || urlError();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ensure that we have the appropriate request data.</span></span><br><span class="line">    <span class="keyword">if</span> (options.data == <span class="literal">null</span> &amp;&amp; model &amp;&amp; (method === <span class="string">&#x27;create&#x27;</span> || method === <span class="string">&#x27;update&#x27;</span> || method === <span class="string">&#x27;patch&#x27;</span>)) &#123;</span><br><span class="line">      params.contentType = <span class="string">&#x27;application/json&#x27;</span>;</span><br><span class="line">      params.data = <span class="built_in">JSON</span>.stringify(options.attrs || model.toJSON(options));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// For older servers, emulate JSON by encoding the request into an HTML-form.</span></span><br><span class="line">    <span class="keyword">if</span> (options.emulateJSON) &#123;</span><br><span class="line">      params.contentType = <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>;</span><br><span class="line">      params.data = params.data ? &#123;<span class="attr">model</span>: params.data&#125; : &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// For older servers, emulate HTTP by mimicking the HTTP method with `_method`</span></span><br><span class="line">    <span class="comment">// And an `X-HTTP-Method-Override` header.</span></span><br><span class="line">    <span class="keyword">if</span> (options.emulateHTTP &amp;&amp; (type === <span class="string">&#x27;PUT&#x27;</span> || type === <span class="string">&#x27;DELETE&#x27;</span> || type === <span class="string">&#x27;PATCH&#x27;</span>)) &#123;</span><br><span class="line">      params.type = <span class="string">&#x27;POST&#x27;</span>;</span><br><span class="line">      <span class="keyword">if</span> (options.emulateJSON) params.data._method = type;</span><br><span class="line">      <span class="keyword">var</span> beforeSend = options.beforeSend;</span><br><span class="line">      options.beforeSend = <span class="function"><span class="keyword">function</span>(<span class="params">xhr</span>) </span>&#123;</span><br><span class="line">        xhr.setRequestHeader(<span class="string">&#x27;X-HTTP-Method-Override&#x27;</span>, type);</span><br><span class="line">        <span class="keyword">if</span> (beforeSend) <span class="keyword">return</span> beforeSend.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Don&#x27;t process data on a non-GET request.</span></span><br><span class="line">    <span class="keyword">if</span> (params.type !== <span class="string">&#x27;GET&#x27;</span> &amp;&amp; !options.emulateJSON) &#123;</span><br><span class="line">      params.processData = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Pass along `textStatus` and `errorThrown` from jQuery.</span></span><br><span class="line">    <span class="keyword">var</span> error = options.error;</span><br><span class="line">    options.error = <span class="function"><span class="keyword">function</span>(<span class="params">xhr, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">      options.textStatus = textStatus;</span><br><span class="line">      options.errorThrown = errorThrown;</span><br><span class="line">      <span class="keyword">if</span> (error) error.call(options.context, xhr, textStatus, errorThrown);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Make the request, allowing the user to override any Ajax options.</span></span><br><span class="line">    <span class="keyword">var</span> xhr = options.xhr = Backbone.ajax(_.extend(params, options));</span><br><span class="line">    model.trigger(<span class="string">&#x27;request&#x27;</span>, model, xhr, options);</span><br><span class="line">    <span class="keyword">return</span> xhr;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Map from CRUD to HTTP for our default `Backbone.sync` implementation.</span></span><br><span class="line">  <span class="keyword">var</span> methodMap = &#123;</span><br><span class="line">    create: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    update: <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">    patch: <span class="string">&#x27;PATCH&#x27;</span>,</span><br><span class="line">    <span class="keyword">delete</span>: <span class="string">&#x27;DELETE&#x27;</span>,</span><br><span class="line">    read: <span class="string">&#x27;GET&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set the default implementation of `Backbone.ajax` to proxy through to `$`.</span></span><br><span class="line">  <span class="comment">// Override this if you&#x27;d like to use a different library.</span></span><br><span class="line">  Backbone.ajax = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Backbone.$.ajax.apply(Backbone.$, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Backbone.Router</span></span><br><span class="line">  <span class="comment">// ---------------</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Routers map faux-URLs to actions, and fire events when routes are</span></span><br><span class="line">  <span class="comment">// matched. Creating a new one sets its `routes` hash, if not set statically.</span></span><br><span class="line">  <span class="keyword">var</span> Router = Backbone.Router = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    options || (options = &#123;&#125;);</span><br><span class="line">    <span class="built_in">this</span>.preinitialize.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">if</span> (options.routes) <span class="built_in">this</span>.routes = options.routes;</span><br><span class="line">    <span class="built_in">this</span>._bindRoutes();</span><br><span class="line">    <span class="built_in">this</span>.initialize.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Cached regular expressions for matching named param parts and splatted</span></span><br><span class="line">  <span class="comment">// parts of route strings.</span></span><br><span class="line">  <span class="keyword">var</span> optionalParam = <span class="regexp">/\((.*?)\)/g</span>;</span><br><span class="line">  <span class="keyword">var</span> namedParam    = <span class="regexp">/(\(\?)?:\w+/g</span>;</span><br><span class="line">  <span class="keyword">var</span> splatParam    = <span class="regexp">/\*\w+/g</span>;</span><br><span class="line">  <span class="keyword">var</span> escapeRegExp  = <span class="regexp">/[\-&#123;&#125;\[\]+?.,\\\^$|#\s]/g</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set up all inheritable **Backbone.Router** properties and methods.</span></span><br><span class="line">  _.extend(Router.prototype, Events, &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// preinitialize is an empty function by default. You can override it with a function</span></span><br><span class="line">    <span class="comment">// or object.  preinitialize will run before any instantiation logic is run in the Router.</span></span><br><span class="line">    preinitialize: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize is an empty function by default. Override it with your own</span></span><br><span class="line">    <span class="comment">// initialization logic.</span></span><br><span class="line">    initialize: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Manually bind a single named route to a callback. For example:</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//     this.route(&#x27;search/:query/p:num&#x27;, &#x27;search&#x27;, function(query, num) &#123;</span></span><br><span class="line">    <span class="comment">//       ...</span></span><br><span class="line">    <span class="comment">//     &#125;);</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    route: <span class="function"><span class="keyword">function</span>(<span class="params">route, name, callback</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!_.isRegExp(route)) route = <span class="built_in">this</span>._routeToRegExp(route);</span><br><span class="line">      <span class="keyword">if</span> (_.isFunction(name)) &#123;</span><br><span class="line">        callback = name;</span><br><span class="line">        name = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!callback) callback = <span class="built_in">this</span>[name];</span><br><span class="line">      <span class="keyword">var</span> router = <span class="built_in">this</span>;</span><br><span class="line">      Backbone.history.route(route, <span class="function"><span class="keyword">function</span>(<span class="params">fragment</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> args = router._extractParameters(route, fragment);</span><br><span class="line">        <span class="keyword">if</span> (router.execute(callback, args, name) !== <span class="literal">false</span>) &#123;</span><br><span class="line">          router.trigger.apply(router, [<span class="string">&#x27;route:&#x27;</span> + name].concat(args));</span><br><span class="line">          router.trigger(<span class="string">&#x27;route&#x27;</span>, name, args);</span><br><span class="line">          Backbone.history.trigger(<span class="string">&#x27;route&#x27;</span>, router, name, args);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Execute a route handler with the provided parameters.  This is an</span></span><br><span class="line">    <span class="comment">// excellent place to do pre-route setup or post-route cleanup.</span></span><br><span class="line">    execute: <span class="function"><span class="keyword">function</span>(<span class="params">callback, args, name</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (callback) callback.apply(<span class="built_in">this</span>, args);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Simple proxy to `Backbone.history` to save a fragment into the history.</span></span><br><span class="line">    navigate: <span class="function"><span class="keyword">function</span>(<span class="params">fragment, options</span>) </span>&#123;</span><br><span class="line">      Backbone.history.navigate(fragment, options);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Bind all defined routes to `Backbone.history`. We have to reverse the</span></span><br><span class="line">    <span class="comment">// order of the routes here to support behavior where the most general</span></span><br><span class="line">    <span class="comment">// routes can be defined at the bottom of the route map.</span></span><br><span class="line">    _bindRoutes: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">this</span>.routes) <span class="keyword">return</span>;</span><br><span class="line">      <span class="built_in">this</span>.routes = _.result(<span class="built_in">this</span>, <span class="string">&#x27;routes&#x27;</span>);</span><br><span class="line">      <span class="keyword">var</span> route, routes = _.keys(<span class="built_in">this</span>.routes);</span><br><span class="line">      <span class="keyword">while</span> ((route = routes.pop()) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.route(route, <span class="built_in">this</span>.routes[route]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Convert a route string into a regular expression, suitable for matching</span></span><br><span class="line">    <span class="comment">// against the current location hash.</span></span><br><span class="line">    _routeToRegExp: <span class="function"><span class="keyword">function</span>(<span class="params">route</span>) </span>&#123;</span><br><span class="line">      route = route.replace(escapeRegExp, <span class="string">&#x27;\\$&amp;&#x27;</span>)</span><br><span class="line">        .replace(optionalParam, <span class="string">&#x27;(?:$1)?&#x27;</span>)</span><br><span class="line">        .replace(namedParam, <span class="function"><span class="keyword">function</span>(<span class="params">match, optional</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> optional ? match : <span class="string">&#x27;([^/?]+)&#x27;</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .replace(splatParam, <span class="string">&#x27;([^?]*?)&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;^&#x27;</span> + route + <span class="string">&#x27;(?:\\?([\\s\\S]*))?$&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Given a route, and a URL fragment that it matches, return the array of</span></span><br><span class="line">    <span class="comment">// extracted decoded parameters. Empty or unmatched parameters will be</span></span><br><span class="line">    <span class="comment">// treated as `null` to normalize cross-browser behavior.</span></span><br><span class="line">    _extractParameters: <span class="function"><span class="keyword">function</span>(<span class="params">route, fragment</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> params = route.exec(fragment).slice(<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">return</span> _.map(params, <span class="function"><span class="keyword">function</span>(<span class="params">param, i</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Don&#x27;t decode the search params.</span></span><br><span class="line">        <span class="keyword">if</span> (i === params.length - <span class="number">1</span>) <span class="keyword">return</span> param || <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> param ? <span class="built_in">decodeURIComponent</span>(param) : <span class="literal">null</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Backbone.History</span></span><br><span class="line">  <span class="comment">// ----------------</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Handles cross-browser history management, based on either</span></span><br><span class="line">  <span class="comment">// [pushState](http://diveintohtml5.info/history.html) and real URLs, or</span></span><br><span class="line">  <span class="comment">// [onhashchange](https://developer.mozilla.org/en-US/docs/DOM/window.onhashchange)</span></span><br><span class="line">  <span class="comment">// and URL fragments. If the browser supports neither (old IE, natch),</span></span><br><span class="line">  <span class="comment">// falls back to polling.</span></span><br><span class="line">  <span class="keyword">var</span> History = Backbone.History = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.handlers = [];</span><br><span class="line">    <span class="built_in">this</span>.checkUrl = <span class="built_in">this</span>.checkUrl.bind(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ensure that `History` can be used outside of the browser.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.location = <span class="built_in">window</span>.location;</span><br><span class="line">      <span class="built_in">this</span>.history = <span class="built_in">window</span>.history;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Cached regex for stripping a leading hash/slash and trailing space.</span></span><br><span class="line">  <span class="keyword">var</span> routeStripper = <span class="regexp">/^[#\/]|\s+$/g</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Cached regex for stripping leading and trailing slashes.</span></span><br><span class="line">  <span class="keyword">var</span> rootStripper = <span class="regexp">/^\/+|\/+$/g</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Cached regex for stripping urls of hash.</span></span><br><span class="line">  <span class="keyword">var</span> pathStripper = <span class="regexp">/#.*$/</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Has the history handling already been started?</span></span><br><span class="line">  History.started = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set up all inheritable **Backbone.History** properties and methods.</span></span><br><span class="line">  _.extend(History.prototype, Events, &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The default interval to poll for hash changes, if necessary, is</span></span><br><span class="line">    <span class="comment">// twenty times a second.</span></span><br><span class="line">    interval: <span class="number">50</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Are we at the app root?</span></span><br><span class="line">    atRoot: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> path = <span class="built_in">this</span>.location.pathname.replace(<span class="regexp">/[^\/]$/</span>, <span class="string">&#x27;$&amp;/&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> path === <span class="built_in">this</span>.root &amp;&amp; !<span class="built_in">this</span>.getSearch();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Does the pathname match the root?</span></span><br><span class="line">    matchRoot: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> path = <span class="built_in">this</span>.decodeFragment(<span class="built_in">this</span>.location.pathname);</span><br><span class="line">      <span class="keyword">var</span> rootPath = path.slice(<span class="number">0</span>, <span class="built_in">this</span>.root.length - <span class="number">1</span>) + <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">      <span class="keyword">return</span> rootPath === <span class="built_in">this</span>.root;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Unicode characters in `location.pathname` are percent encoded so they&#x27;re</span></span><br><span class="line">    <span class="comment">// decoded for comparison. `%25` should not be decoded since it may be part</span></span><br><span class="line">    <span class="comment">// of an encoded parameter.</span></span><br><span class="line">    decodeFragment: <span class="function"><span class="keyword">function</span>(<span class="params">fragment</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">decodeURI</span>(fragment.replace(<span class="regexp">/%25/g</span>, <span class="string">&#x27;%2525&#x27;</span>));</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// In IE6, the hash fragment and search params are incorrect if the</span></span><br><span class="line">    <span class="comment">// fragment contains `?`.</span></span><br><span class="line">    getSearch: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> match = <span class="built_in">this</span>.location.href.replace(<span class="regexp">/#.*/</span>, <span class="string">&#x27;&#x27;</span>).match(<span class="regexp">/\?.+/</span>);</span><br><span class="line">      <span class="keyword">return</span> match ? match[<span class="number">0</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Gets the true hash value. Cannot use location.hash directly due to bug</span></span><br><span class="line">    <span class="comment">// in Firefox where location.hash will always be decoded.</span></span><br><span class="line">    getHash: <span class="function"><span class="keyword">function</span>(<span class="params"><span class="built_in">window</span></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> match = (<span class="built_in">window</span> || <span class="built_in">this</span>).location.href.match(<span class="regexp">/#(.*)$/</span>);</span><br><span class="line">      <span class="keyword">return</span> match ? match[<span class="number">1</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the pathname and search params, without the root.</span></span><br><span class="line">    getPath: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> path = <span class="built_in">this</span>.decodeFragment(</span><br><span class="line">        <span class="built_in">this</span>.location.pathname + <span class="built_in">this</span>.getSearch()</span><br><span class="line">      ).slice(<span class="built_in">this</span>.root.length - <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">return</span> path.charAt(<span class="number">0</span>) === <span class="string">&#x27;/&#x27;</span> ? path.slice(<span class="number">1</span>) : path;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the cross-browser normalized URL fragment from the path or hash.</span></span><br><span class="line">    getFragment: <span class="function"><span class="keyword">function</span>(<span class="params">fragment</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (fragment == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>._usePushState || !<span class="built_in">this</span>._wantsHashChange) &#123;</span><br><span class="line">          fragment = <span class="built_in">this</span>.getPath();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          fragment = <span class="built_in">this</span>.getHash();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> fragment.replace(routeStripper, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start the hash change handling, returning `true` if the current URL matches</span></span><br><span class="line">    <span class="comment">// an existing route, and `false` otherwise.</span></span><br><span class="line">    start: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (History.started) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Backbone.history has already been started&#x27;</span>);</span><br><span class="line">      History.started = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Figure out the initial configuration. Do we need an iframe?</span></span><br><span class="line">      <span class="comment">// Is pushState desired ... is it available?</span></span><br><span class="line">      <span class="built_in">this</span>.options          = _.extend(&#123;<span class="attr">root</span>: <span class="string">&#x27;/&#x27;</span>&#125;, <span class="built_in">this</span>.options, options);</span><br><span class="line">      <span class="built_in">this</span>.root             = <span class="built_in">this</span>.options.root;</span><br><span class="line">      <span class="built_in">this</span>._wantsHashChange = <span class="built_in">this</span>.options.hashChange !== <span class="literal">false</span>;</span><br><span class="line">      <span class="built_in">this</span>._hasHashChange   = <span class="string">&#x27;onhashchange&#x27;</span> <span class="keyword">in</span> <span class="built_in">window</span> &amp;&amp; (<span class="built_in">document</span>.documentMode === <span class="keyword">void</span> <span class="number">0</span> || <span class="built_in">document</span>.documentMode &gt; <span class="number">7</span>);</span><br><span class="line">      <span class="built_in">this</span>._useHashChange   = <span class="built_in">this</span>._wantsHashChange &amp;&amp; <span class="built_in">this</span>._hasHashChange;</span><br><span class="line">      <span class="built_in">this</span>._wantsPushState  = !!<span class="built_in">this</span>.options.pushState;</span><br><span class="line">      <span class="built_in">this</span>._hasPushState    = !!(<span class="built_in">this</span>.history &amp;&amp; <span class="built_in">this</span>.history.pushState);</span><br><span class="line">      <span class="built_in">this</span>._usePushState    = <span class="built_in">this</span>._wantsPushState &amp;&amp; <span class="built_in">this</span>._hasPushState;</span><br><span class="line">      <span class="built_in">this</span>.fragment         = <span class="built_in">this</span>.getFragment();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Normalize root to always include a leading and trailing slash.</span></span><br><span class="line">      <span class="built_in">this</span>.root = (<span class="string">&#x27;/&#x27;</span> + <span class="built_in">this</span>.root + <span class="string">&#x27;/&#x27;</span>).replace(rootStripper, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Transition from hashChange to pushState or vice versa if both are</span></span><br><span class="line">      <span class="comment">// requested.</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>._wantsHashChange &amp;&amp; <span class="built_in">this</span>._wantsPushState) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If we&#x27;ve started off with a route from a `pushState`-enabled</span></span><br><span class="line">        <span class="comment">// browser, but we&#x27;re currently in a browser that doesn&#x27;t support it...</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>._hasPushState &amp;&amp; !<span class="built_in">this</span>.atRoot()) &#123;</span><br><span class="line">          <span class="keyword">var</span> rootPath = <span class="built_in">this</span>.root.slice(<span class="number">0</span>, -<span class="number">1</span>) || <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">          <span class="built_in">this</span>.location.replace(rootPath + <span class="string">&#x27;#&#x27;</span> + <span class="built_in">this</span>.getPath());</span><br><span class="line">          <span class="comment">// Return immediately as browser will do redirect to new url</span></span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Or if we&#x27;ve started out with a hash-based route, but we&#x27;re currently</span></span><br><span class="line">        <span class="comment">// in a browser where it could be `pushState`-based instead...</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>._hasPushState &amp;&amp; <span class="built_in">this</span>.atRoot()) &#123;</span><br><span class="line">          <span class="built_in">this</span>.navigate(<span class="built_in">this</span>.getHash(), &#123;<span class="attr">replace</span>: <span class="literal">true</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Proxy an iframe to handle location events if the browser doesn&#x27;t</span></span><br><span class="line">      <span class="comment">// support the `hashchange` event, HTML5 history, or the user wants</span></span><br><span class="line">      <span class="comment">// `hashChange` but not `pushState`.</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">this</span>._hasHashChange &amp;&amp; <span class="built_in">this</span>._wantsHashChange &amp;&amp; !<span class="built_in">this</span>._usePushState) &#123;</span><br><span class="line">        <span class="built_in">this</span>.iframe = <span class="built_in">document</span>.createElement(<span class="string">&#x27;iframe&#x27;</span>);</span><br><span class="line">        <span class="built_in">this</span>.iframe.src = <span class="string">&#x27;javascript:0&#x27;</span>;</span><br><span class="line">        <span class="built_in">this</span>.iframe.style.display = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">        <span class="built_in">this</span>.iframe.tabIndex = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">var</span> body = <span class="built_in">document</span>.body;</span><br><span class="line">        <span class="comment">// Using `appendChild` will throw on IE &lt; 9 if the document is not ready.</span></span><br><span class="line">        <span class="keyword">var</span> iWindow = body.insertBefore(<span class="built_in">this</span>.iframe, body.firstChild).contentWindow;</span><br><span class="line">        iWindow.document.open();</span><br><span class="line">        iWindow.document.close();</span><br><span class="line">        iWindow.location.hash = <span class="string">&#x27;#&#x27;</span> + <span class="built_in">this</span>.fragment;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Add a cross-platform `addEventListener` shim for older browsers.</span></span><br><span class="line">      <span class="keyword">var</span> addEventListener = <span class="built_in">window</span>.addEventListener || <span class="function"><span class="keyword">function</span>(<span class="params">eventName, listener</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> attachEvent(<span class="string">&#x27;on&#x27;</span> + eventName, listener);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Depending on whether we&#x27;re using pushState or hashes, and whether</span></span><br><span class="line">      <span class="comment">// &#x27;onhashchange&#x27; is supported, determine how we check the URL state.</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>._usePushState) &#123;</span><br><span class="line">        addEventListener(<span class="string">&#x27;popstate&#x27;</span>, <span class="built_in">this</span>.checkUrl, <span class="literal">false</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>._useHashChange &amp;&amp; !<span class="built_in">this</span>.iframe) &#123;</span><br><span class="line">        addEventListener(<span class="string">&#x27;hashchange&#x27;</span>, <span class="built_in">this</span>.checkUrl, <span class="literal">false</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>._wantsHashChange) &#123;</span><br><span class="line">        <span class="built_in">this</span>._checkUrlInterval = <span class="built_in">setInterval</span>(<span class="built_in">this</span>.checkUrl, <span class="built_in">this</span>.interval);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">this</span>.options.silent) <span class="keyword">return</span> <span class="built_in">this</span>.loadUrl();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Disable Backbone.history, perhaps temporarily. Not useful in a real app,</span></span><br><span class="line">    <span class="comment">// but possibly useful for unit testing Routers.</span></span><br><span class="line">    stop: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Add a cross-platform `removeEventListener` shim for older browsers.</span></span><br><span class="line">      <span class="keyword">var</span> removeEventListener = <span class="built_in">window</span>.removeEventListener || <span class="function"><span class="keyword">function</span>(<span class="params">eventName, listener</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> detachEvent(<span class="string">&#x27;on&#x27;</span> + eventName, listener);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Remove window listeners.</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>._usePushState) &#123;</span><br><span class="line">        removeEventListener(<span class="string">&#x27;popstate&#x27;</span>, <span class="built_in">this</span>.checkUrl, <span class="literal">false</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>._useHashChange &amp;&amp; !<span class="built_in">this</span>.iframe) &#123;</span><br><span class="line">        removeEventListener(<span class="string">&#x27;hashchange&#x27;</span>, <span class="built_in">this</span>.checkUrl, <span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Clean up the iframe if necessary.</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.iframe) &#123;</span><br><span class="line">        <span class="built_in">document</span>.body.removeChild(<span class="built_in">this</span>.iframe);</span><br><span class="line">        <span class="built_in">this</span>.iframe = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Some environments will throw when clearing an undefined interval.</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>._checkUrlInterval) <span class="built_in">clearInterval</span>(<span class="built_in">this</span>._checkUrlInterval);</span><br><span class="line">      History.started = <span class="literal">false</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add a route to be tested when the fragment changes. Routes added later</span></span><br><span class="line">    <span class="comment">// may override previous routes.</span></span><br><span class="line">    route: <span class="function"><span class="keyword">function</span>(<span class="params">route, callback</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.handlers.unshift(&#123;<span class="attr">route</span>: route, <span class="attr">callback</span>: callback&#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Checks the current URL to see if it has changed, and if it has,</span></span><br><span class="line">    <span class="comment">// calls `loadUrl`, normalizing across the hidden iframe.</span></span><br><span class="line">    checkUrl: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> current = <span class="built_in">this</span>.getFragment();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If the user pressed the back button, the iframe&#x27;s hash will have</span></span><br><span class="line">      <span class="comment">// changed and we should use that for comparison.</span></span><br><span class="line">      <span class="keyword">if</span> (current === <span class="built_in">this</span>.fragment &amp;&amp; <span class="built_in">this</span>.iframe) &#123;</span><br><span class="line">        current = <span class="built_in">this</span>.getHash(<span class="built_in">this</span>.iframe.contentWindow);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (current === <span class="built_in">this</span>.fragment) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.iframe) <span class="built_in">this</span>.navigate(current);</span><br><span class="line">      <span class="built_in">this</span>.loadUrl();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attempt to load the current URL fragment. If a route succeeds with a</span></span><br><span class="line">    <span class="comment">// match, returns `true`. If no defined routes matches the fragment,</span></span><br><span class="line">    <span class="comment">// returns `false`.</span></span><br><span class="line">    loadUrl: <span class="function"><span class="keyword">function</span>(<span class="params">fragment</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// If the root doesn&#x27;t match, no routes can match either.</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">this</span>.matchRoot()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      fragment = <span class="built_in">this</span>.fragment = <span class="built_in">this</span>.getFragment(fragment);</span><br><span class="line">      <span class="keyword">return</span> _.some(<span class="built_in">this</span>.handlers, <span class="function"><span class="keyword">function</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (handler.route.test(fragment)) &#123;</span><br><span class="line">          handler.callback(fragment);</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Save a fragment into the hash history, or replace the URL state if the</span></span><br><span class="line">    <span class="comment">// &#x27;replace&#x27; option is passed. You are responsible for properly URL-encoding</span></span><br><span class="line">    <span class="comment">// the fragment in advance.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// The options object can contain `trigger: true` if you wish to have the</span></span><br><span class="line">    <span class="comment">// route callback be fired (not usually desirable), or `replace: true`, if</span></span><br><span class="line">    <span class="comment">// you wish to modify the current URL without adding an entry to the history.</span></span><br><span class="line">    navigate: <span class="function"><span class="keyword">function</span>(<span class="params">fragment, options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!History.started) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (!options || options === <span class="literal">true</span>) options = &#123;<span class="attr">trigger</span>: !!options&#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Normalize the fragment.</span></span><br><span class="line">      fragment = <span class="built_in">this</span>.getFragment(fragment || <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Don&#x27;t include a trailing slash on the root.</span></span><br><span class="line">      <span class="keyword">var</span> rootPath = <span class="built_in">this</span>.root;</span><br><span class="line">      <span class="keyword">if</span> (fragment === <span class="string">&#x27;&#x27;</span> || fragment.charAt(<span class="number">0</span>) === <span class="string">&#x27;?&#x27;</span>) &#123;</span><br><span class="line">        rootPath = rootPath.slice(<span class="number">0</span>, -<span class="number">1</span>) || <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> url = rootPath + fragment;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Strip the fragment of the query and hash for matching.</span></span><br><span class="line">      fragment = fragment.replace(pathStripper, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Decode for matching.</span></span><br><span class="line">      <span class="keyword">var</span> decodedFragment = <span class="built_in">this</span>.decodeFragment(fragment);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.fragment === decodedFragment) <span class="keyword">return</span>;</span><br><span class="line">      <span class="built_in">this</span>.fragment = decodedFragment;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If pushState is available, we use it to set the fragment as a real URL.</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>._usePushState) &#123;</span><br><span class="line">        <span class="built_in">this</span>.history[options.replace ? <span class="string">&#x27;replaceState&#x27;</span> : <span class="string">&#x27;pushState&#x27;</span>](&#123;&#125;, <span class="built_in">document</span>.title, url);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If hash changes haven&#x27;t been explicitly disabled, update the hash</span></span><br><span class="line">      <span class="comment">// fragment to store history.</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>._wantsHashChange) &#123;</span><br><span class="line">        <span class="built_in">this</span>._updateHash(<span class="built_in">this</span>.location, fragment, options.replace);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.iframe &amp;&amp; fragment !== <span class="built_in">this</span>.getHash(<span class="built_in">this</span>.iframe.contentWindow)) &#123;</span><br><span class="line">          <span class="keyword">var</span> iWindow = <span class="built_in">this</span>.iframe.contentWindow;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Opening and closing the iframe tricks IE7 and earlier to push a</span></span><br><span class="line">          <span class="comment">// history entry on hash-tag change.  When replace is true, we don&#x27;t</span></span><br><span class="line">          <span class="comment">// want this.</span></span><br><span class="line">          <span class="keyword">if</span> (!options.replace) &#123;</span><br><span class="line">            iWindow.document.open();</span><br><span class="line">            iWindow.document.close();</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="built_in">this</span>._updateHash(iWindow.location, fragment, options.replace);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If you&#x27;ve told us that you explicitly don&#x27;t want fallback hashchange-</span></span><br><span class="line">      <span class="comment">// based history, then `navigate` becomes a page refresh.</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.location.assign(url);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (options.trigger) <span class="keyword">return</span> <span class="built_in">this</span>.loadUrl(fragment);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update the hash location, either replacing the current entry, or adding</span></span><br><span class="line">    <span class="comment">// a new one to the browser history.</span></span><br><span class="line">    _updateHash: <span class="function"><span class="keyword">function</span>(<span class="params">location, fragment, replace</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (replace) &#123;</span><br><span class="line">        <span class="keyword">var</span> href = location.href.replace(<span class="regexp">/(javascript:|#).*$/</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        location.replace(href + <span class="string">&#x27;#&#x27;</span> + fragment);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Some browsers require that `hash` contains a leading #.</span></span><br><span class="line">        location.hash = <span class="string">&#x27;#&#x27;</span> + fragment;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create the default Backbone.history.</span></span><br><span class="line">  Backbone.history = <span class="keyword">new</span> History;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Helpers</span></span><br><span class="line">  <span class="comment">// -------</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Helper function to correctly set up the prototype chain for subclasses.</span></span><br><span class="line">  <span class="comment">// Similar to `goog.inherits`, but uses a hash of prototype properties and</span></span><br><span class="line">  <span class="comment">// class properties to be extended.</span></span><br><span class="line">  <span class="keyword">var</span> extend = <span class="function"><span class="keyword">function</span>(<span class="params">protoProps, staticProps</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> parent = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">var</span> child;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The constructor function for the new subclass is either defined by you</span></span><br><span class="line">    <span class="comment">// (the &quot;constructor&quot; property in your `extend` definition), or defaulted</span></span><br><span class="line">    <span class="comment">// by us to simply call the parent constructor.</span></span><br><span class="line">    <span class="keyword">if</span> (protoProps &amp;&amp; _.has(protoProps, <span class="string">&#x27;constructor&#x27;</span>)) &#123;</span><br><span class="line">      child = protoProps.constructor;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      child = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> parent.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>); &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add static properties to the constructor function, if supplied.</span></span><br><span class="line">    _.extend(child, parent, staticProps);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the prototype chain to inherit from `parent`, without calling</span></span><br><span class="line">    <span class="comment">// `parent`&#x27;s constructor function and add the prototype properties.</span></span><br><span class="line">    child.prototype = _.create(parent.prototype, protoProps);</span><br><span class="line">    child.prototype.constructor = child;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set a convenience property in case the parent&#x27;s prototype is needed</span></span><br><span class="line">    <span class="comment">// later.</span></span><br><span class="line">    child.__super__ = parent.prototype;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> child;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set up inheritance for the model, collection, router, view and history.</span></span><br><span class="line">  Model.extend = Collection.extend = Router.extend = View.extend = History.extend = extend;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Throw an error when a URL is needed, and none is supplied.</span></span><br><span class="line">  <span class="keyword">var</span> urlError = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;A &quot;url&quot; property or function must be specified&#x27;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Wrap an optional error callback with a fallback error event.</span></span><br><span class="line">  <span class="keyword">var</span> wrapError = <span class="function"><span class="keyword">function</span>(<span class="params">model, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> error = options.error;</span><br><span class="line">    options.error = <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (error) error.call(options.context, model, resp, options);</span><br><span class="line">      model.trigger(<span class="string">&#x27;error&#x27;</span>, model, resp, options);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Backbone;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
            <div class="post-copyright">
    <div class="content">
        <p>最后更新： 2021年09月23日 14:18</p>
<!--        <p>原始链接： <a class="post-url" href="/2021/09/10/%E3%80%90%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E3%80%91backbone.js/" title="【源码解析】backbone.js">https://wisiw.github.io.git/2021/09/10/%E3%80%90%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E3%80%91backbone.js/</a></p>-->
        <footer>
            <a href="https://WiSiW.github.io.git">
                <img src="/images/logo.png" alt="wsw">
                wsw
            </a>
        </footer>
    </div>
</div>

      
        
            

        
    </div>
    <footer class="article-footer">
        
        
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://wisiw.github.io.git/2021/09/10/%E3%80%90%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E3%80%91backbone.js/&title=《【源码解析】backbone.js》 — 韦绍炜的博客&pic=/images/backbone.png" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://wisiw.github.io.git/2021/09/10/%E3%80%90%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E3%80%91backbone.js/&title=《【源码解析】backbone.js》 — 韦绍炜的博客&source=" data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://wisiw.github.io.git/2021/09/10/%E3%80%90%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E3%80%91backbone.js/" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《【源码解析】backbone.js》 — 韦绍炜的博客&url=https://wisiw.github.io.git/2021/09/10/%E3%80%90%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E3%80%91backbone.js/&via=https://WiSiW.github.io.git" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://wisiw.github.io.git/2021/09/10/%E3%80%90%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E3%80%91backbone.js/" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAADLElEQVR42u3awW7rMAwEwP7/T/sBPbV4iLwkVSBWRqeicWyPLgyX+vqK1/W91v9Zf+v6sV59ur7P/yt/k+bCxsbGfgj7Wq5XL51g1lcm2/rqHdbbt7ZgY2Njn8pOyk8CyO+wxuTFMt90bGxsbOxeQ5IXsF4Zw8bGxsbusauNQa9Y7gqnsLGxsT+BnReGZojTam8m99mWpWFjY2O/Pbs66H3nv/9wvo2NjY39luyrtSbNw6Tw5Nff3A0bGxv7IHZ17JrHTPndetdXDxjdZGnY2NjYj2VPGMkL7d2OdbHExsbG/kx2L5RJQvxJG1NtZpoBEzY2NvYR7LzwTB5ZbWySjRgNMLCxsbEPYk8OL1Y3qDoqmJe0m63ExsbGPoJdjdrnm1I9WNlreG6ehY2NjX0ce/LINSz/NG8t8u9GFRsbGxv7CHbvZ31vAJxfX+6o8qYIGxsb+zh2flCmOtDND9xMSl31fbCxsbFPYudhTe83/GTc28TkW4mNjY19EDuJgSbD2nyD5gODasHDxsbGfjo7D4yqsN72TUKlK17Y2NjYp7InsASZl8nkWdVB768rsbGxsQ9iVyP7PPrvjYf3NjnNLA0bGxv7UeycV21L8kJVjbQ2HN/ExsbGPpQ9P0bT26x8iFstfi+3DxsbG/sgdvVATLXgVQOpPOivHsHExsbGPpXdC/3zx1RLYL5NvbYHGxsb+zx29Whjr5DkTctkoJu/CTY2NvZJ7OSHfj52zfG9UW6viN60ItjY2NhHsHtxf/VF8/FtdZvWeGxsbOxPYFdLVB7fJ6WxWvaqzdJNloaNjY39cHaUOQWrOsotJF5xODUKnrCxsbEfy+41DHkbMB8/9AKvm+9iY2NjH8T+62LTKz+98cCGio2NjY39QPZVXLuO5uQDhvlAIpoJY2NjYz+WXS0G1XB/ckAnL0uTyAkbGxv7DPZkZJvvaLUgVZ9bDsiwsbGxj2P3XnQ+DOiVvV6ohI2NjY3di5z2Dgm2HRjCxsbG/kh2NZOZDAkm74ONjY39mexeqNQbxFaHB9UyWT55io2Njf1wdnXQWy1m1c3Kr8/HAxvm29jY2NjvyP4H78ODBriwIuoAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>

<div class="mask"></div>

        
        <ul class="article-footer-menu">
            
            
  <li class="article-footer-tags">
    <i class="fa fa-tags"></i>
      
    <a href="/tags/源码/" class="color3">源码</a>
      
    <a href="/tags/backbone.js/" class="color2">backbone.js</a>
      
  </li>

        </ul>
        
    </footer>
  </div>
</article>



<nav id="article-nav">
  
    <a href="/2021/09/13/app%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81/" id="article-nav-newer" class="article-nav-link-wrap">

      <span class="article-nav-title">
        <i class="fa fa-hand-o-left" aria-hidden="true"></i>
        
          app相关代码
        
      </span>
    </a>
  
  
    <a href="/2021/08/30/%E3%80%90JavaScript%E3%80%91forEach%E3%80%81map%E3%80%81reduce%E3%80%81filter%E7%9A%84%E5%8C%BA%E5%88%AB/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">【JavaScript】forEach、map、reduce、filter的区别</span>
      <i class="fa fa-hand-o-right" aria-hidden="true"></i>
    </a>
  
</nav>



    

</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2021 wsw<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
  var mihoConfig = {
      root: "https://WiSiW.github.io.git",
      animate: true,
      isHome: false,
      share: true,
      reward: 0
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="/categories/Angular/">Angular</a><a class="category-link" href="/categories/React/">React</a><a class="category-link" href="/categories/Vue/">Vue</a><a class="category-link" href="/categories/axios/">axios</a><a class="category-link" href="/categories/cli/">cli</a><a class="category-link" href="/categories/react/">react</a><a class="category-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%B7%A5%E5%85%B7/">代码工具</a><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84/">前端架构</a><a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a><a class="category-link" href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a>
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="/tags/AST%E8%AF%AD%E6%B3%95%E6%A0%91/" style="font-size: 10px;">AST语法树</a> <a href="/tags/Angular/" style="font-size: 10px;">Angular</a> <a href="/tags/CSS/" style="font-size: 12.22px;">CSS</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Echarts/" style="font-size: 10px;">Echarts</a> <a href="/tags/Excel/" style="font-size: 10px;">Excel</a> <a href="/tags/Flux/" style="font-size: 10px;">Flux</a> <a href="/tags/Java/" style="font-size: 12.22px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 17.78px;">JavaScript</a> <a href="/tags/JavaScript-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">JavaScript - 设计模式</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/MyBatis-Plus/" style="font-size: 10px;">MyBatis-Plus</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Node/" style="font-size: 12.22px;">Node</a> <a href="/tags/Promise/" style="font-size: 10px;">Promise</a> <a href="/tags/React/" style="font-size: 11.11px;">React</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/Uni/" style="font-size: 10px;">Uni</a> <a href="/tags/Vue/" style="font-size: 18.89px;">Vue</a> <a href="/tags/Vue-cli/" style="font-size: 10px;">Vue-cli</a> <a href="/tags/VueRouter/" style="font-size: 10px;">VueRouter</a> <a href="/tags/Webpack/" style="font-size: 13.33px;">Webpack</a> <a href="/tags/app/" style="font-size: 10px;">app</a> <a href="/tags/axios/" style="font-size: 10px;">axios</a> <a href="/tags/backbone-js/" style="font-size: 10px;">backbone.js</a> <a href="/tags/browser/" style="font-size: 10px;">browser</a> <a href="/tags/cli/" style="font-size: 10px;">cli</a> <a href="/tags/echarts/" style="font-size: 10px;">echarts</a> <a href="/tags/fileDownload/" style="font-size: 10px;">fileDownload</a> <a href="/tags/fileUpload/" style="font-size: 10px;">fileUpload</a> <a href="/tags/git/" style="font-size: 11.11px;">git</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/map/" style="font-size: 10px;">map</a> <a href="/tags/mybatis/" style="font-size: 10px;">mybatis</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/npm/" style="font-size: 11.11px;">npm</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/route/" style="font-size: 10px;">route</a> <a href="/tags/vuex/" style="font-size: 10px;">vuex</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/%E3%80%8A%E6%B7%B1%E5%85%A5React%E6%8A%80%E6%9C%AF%E6%A0%88%E3%80%8B/" style="font-size: 11.11px;">《深入React技术栈》</a> <a href="/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/" style="font-size: 10px;">二分查找</a> <a href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" style="font-size: 10px;">二叉树</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E5%B7%A5%E5%85%B7/" style="font-size: 11.11px;">代码工具</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/" style="font-size: 15.56px;">代码片段</a> <a href="/tags/%E4%BD%BF%E7%94%A8/" style="font-size: 10px;">使用</a> <a href="/tags/%E5%85%A8%E5%B1%80%E5%BC%B9%E7%AA%97/" style="font-size: 10px;">全局弹窗</a> <a href="/tags/%E5%85%AB%E7%9A%87%E5%90%8E%E9%97%AE%E9%A2%98/" style="font-size: 10px;">八皇后问题</a> <a href="/tags/%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/" style="font-size: 10px;">分支管理</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">前端</a> <a href="/tags/%E5%89%8D%E7%AB%AF-%E6%9E%B6%E6%9E%84/" style="font-size: 10px;">前端 - 架构</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 12.22px;">前端工程化</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84/" style="font-size: 10px;">前端架构</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E7%BB%84%E4%BB%B6%E5%8C%96/" style="font-size: 10px;">前端组件化</a> <a href="/tags/%E5%89%8D%E7%BC%80%E3%80%81%E4%B8%AD%E7%BC%80%E3%80%81%E5%90%8E%E7%BC%80%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10px;">前缀、中缀、后缀表达式</a> <a href="/tags/%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81/" style="font-size: 11.11px;">功能代码</a> <a href="/tags/%E5%8E%9F%E7%90%86/" style="font-size: 11.11px;">原理</a> <a href="/tags/%E5%90%8E%E7%AB%AF/" style="font-size: 10px;">后端</a> <a href="/tags/%E5%93%88%E5%B8%8C%E8%A1%A8/" style="font-size: 10px;">哈希表</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F/" style="font-size: 10px;">响应式</a> <a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 10px;">基础</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" style="font-size: 11.11px;">微前端</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 10px;">微服务</a> <a href="/tags/%E6%89%8B%E5%86%99/" style="font-size: 10px;">手写</a> <a href="/tags/%E6%8A%80%E5%B7%A7/" style="font-size: 10px;">技巧</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">排序</a> <a href="/tags/%E6%8F%92%E5%80%BC%E6%9F%A5%E6%89%BE/" style="font-size: 10px;">插值查找</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 10px;">教程</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E3%80%81%E7%AE%97%E6%B3%95/" style="font-size: 10px;">数据、算法</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9/" style="font-size: 10px;">数据压缩</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94%E5%BC%8F/" style="font-size: 10px;">数据响应式</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">数据结构</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" style="font-size: 10px;">数据结构与算法</a> <a href="/tags/%E6%95%B0%E7%BB%84%E5%AE%9E%E7%8E%B0%E5%8C%85/" style="font-size: 10px;">数组实现包</a> <a href="/tags/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%9F%A5%E6%89%BE/" style="font-size: 10px;">斐波那契查找</a> <a href="/tags/%E6%96%AD%E7%82%B9%E7%BB%AD%E4%BC%A0/" style="font-size: 10px;">断点续传</a> <a href="/tags/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/" style="font-size: 10px;">权限管理</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 12.22px;">架构</a> <a href="/tags/%E6%A0%88/" style="font-size: 10px;">栈</a> <a href="/tags/%E6%A8%A1%E5%9D%97%E6%89%93%E5%8C%85/" style="font-size: 10px;">模块打包</a> <a href="/tags/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/" style="font-size: 10px;">模板引擎</a> <a href="/tags/%E6%A8%A1%E6%9D%BF%E8%A7%A3%E6%9E%90/" style="font-size: 10px;">模板解析</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 14.44px;">源码</a> <a href="/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" style="font-size: 15.56px;">源码解析</a> <a href="/tags/%E7%80%91%E5%B8%83%E6%B5%81/" style="font-size: 10px;">瀑布流</a> <a href="/tags/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" style="font-size: 10px;">生命周期</a> <a href="/tags/%E7%A8%80%E7%96%8F%E6%95%B0%E7%BB%84/" style="font-size: 10px;">稀疏数组</a> <a href="/tags/%E7%AC%AC%E4%B8%80%E7%AB%A0/" style="font-size: 10px;">第一章</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 20px;">算法</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%E8%AE%A1%E7%AE%97/" style="font-size: 10px;">算法 -时间复杂度计算</a> <a href="/tags/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%B8%88%E8%80%83%E8%AF%95/" style="font-size: 10px;">系统架构设计师考试</a> <a href="/tags/%E7%BA%A6%E7%91%9F%E5%A4%AB%E9%97%AE%E9%A2%98/" style="font-size: 10px;">约瑟夫问题</a> <a href="/tags/%E7%BB%84%E4%BB%B6/" style="font-size: 10px;">组件</a> <a href="/tags/%E7%BB%84%E4%BB%B6%E5%8C%96/" style="font-size: 10px;">组件化</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E9%A2%98/" style="font-size: 10px;">编程题</a> <a href="/tags/%E8%99%9A%E6%8B%9FDOM%E4%B8%8Ediff%E7%AE%97%E6%B3%95/" style="font-size: 10px;">虚拟DOM与diff算法</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 12.22px;">读书笔记</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-React-%E3%80%8A%E6%B7%B1%E5%85%A5React%E6%8A%80%E6%9C%AF%E6%A0%88%E3%80%8B/" style="font-size: 10px;">读书笔记 - React - 《深入React技术栈》</a> <a href="/tags/%E8%B8%A9%E5%9D%91/" style="font-size: 10px;">踩坑</a> <a href="/tags/%E8%BF%B7%E5%AE%AB%E5%9B%9E%E6%BA%AF/" style="font-size: 10px;">迷宫回溯</a> <a href="/tags/%E9%80%86%E6%B3%A2%E5%85%B0%E5%BC%8F/" style="font-size: 10px;">逆波兰式</a> <a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size: 10px;">链表</a> <a href="/tags/%E9%98%9F%E5%88%97/" style="font-size: 10px;">队列</a> <a href="/tags/%E9%9B%86%E7%BE%A4/" style="font-size: 10px;">集群</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 16.67px;">面试题</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a  href="/">
                    <i class="fa fa-home"></i><span>Home</span>
                </a>
            </li>
            
            <li>
                <a  href="/archives">
                    <i class="fa fa-archive"></i><span>Archives</span>
                </a>
            </li>
            
            <li>
                <a  href="/about">
                    <i class="fa fa-user"></i><span>About</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="/tags/AST%E8%AF%AD%E6%B3%95%E6%A0%91/" style="font-size: 10px;">AST语法树</a> <a href="/tags/Angular/" style="font-size: 10px;">Angular</a> <a href="/tags/CSS/" style="font-size: 12.22px;">CSS</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Echarts/" style="font-size: 10px;">Echarts</a> <a href="/tags/Excel/" style="font-size: 10px;">Excel</a> <a href="/tags/Flux/" style="font-size: 10px;">Flux</a> <a href="/tags/Java/" style="font-size: 12.22px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 17.78px;">JavaScript</a> <a href="/tags/JavaScript-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">JavaScript - 设计模式</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/MyBatis-Plus/" style="font-size: 10px;">MyBatis-Plus</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Node/" style="font-size: 12.22px;">Node</a> <a href="/tags/Promise/" style="font-size: 10px;">Promise</a> <a href="/tags/React/" style="font-size: 11.11px;">React</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/Uni/" style="font-size: 10px;">Uni</a> <a href="/tags/Vue/" style="font-size: 18.89px;">Vue</a> <a href="/tags/Vue-cli/" style="font-size: 10px;">Vue-cli</a> <a href="/tags/VueRouter/" style="font-size: 10px;">VueRouter</a> <a href="/tags/Webpack/" style="font-size: 13.33px;">Webpack</a> <a href="/tags/app/" style="font-size: 10px;">app</a> <a href="/tags/axios/" style="font-size: 10px;">axios</a> <a href="/tags/backbone-js/" style="font-size: 10px;">backbone.js</a> <a href="/tags/browser/" style="font-size: 10px;">browser</a> <a href="/tags/cli/" style="font-size: 10px;">cli</a> <a href="/tags/echarts/" style="font-size: 10px;">echarts</a> <a href="/tags/fileDownload/" style="font-size: 10px;">fileDownload</a> <a href="/tags/fileUpload/" style="font-size: 10px;">fileUpload</a> <a href="/tags/git/" style="font-size: 11.11px;">git</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/map/" style="font-size: 10px;">map</a> <a href="/tags/mybatis/" style="font-size: 10px;">mybatis</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/npm/" style="font-size: 11.11px;">npm</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/route/" style="font-size: 10px;">route</a> <a href="/tags/vuex/" style="font-size: 10px;">vuex</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/%E3%80%8A%E6%B7%B1%E5%85%A5React%E6%8A%80%E6%9C%AF%E6%A0%88%E3%80%8B/" style="font-size: 11.11px;">《深入React技术栈》</a> <a href="/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/" style="font-size: 10px;">二分查找</a> <a href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" style="font-size: 10px;">二叉树</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E5%B7%A5%E5%85%B7/" style="font-size: 11.11px;">代码工具</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/" style="font-size: 15.56px;">代码片段</a> <a href="/tags/%E4%BD%BF%E7%94%A8/" style="font-size: 10px;">使用</a> <a href="/tags/%E5%85%A8%E5%B1%80%E5%BC%B9%E7%AA%97/" style="font-size: 10px;">全局弹窗</a> <a href="/tags/%E5%85%AB%E7%9A%87%E5%90%8E%E9%97%AE%E9%A2%98/" style="font-size: 10px;">八皇后问题</a> <a href="/tags/%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/" style="font-size: 10px;">分支管理</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">前端</a> <a href="/tags/%E5%89%8D%E7%AB%AF-%E6%9E%B6%E6%9E%84/" style="font-size: 10px;">前端 - 架构</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 12.22px;">前端工程化</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84/" style="font-size: 10px;">前端架构</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E7%BB%84%E4%BB%B6%E5%8C%96/" style="font-size: 10px;">前端组件化</a> <a href="/tags/%E5%89%8D%E7%BC%80%E3%80%81%E4%B8%AD%E7%BC%80%E3%80%81%E5%90%8E%E7%BC%80%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10px;">前缀、中缀、后缀表达式</a> <a href="/tags/%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81/" style="font-size: 11.11px;">功能代码</a> <a href="/tags/%E5%8E%9F%E7%90%86/" style="font-size: 11.11px;">原理</a> <a href="/tags/%E5%90%8E%E7%AB%AF/" style="font-size: 10px;">后端</a> <a href="/tags/%E5%93%88%E5%B8%8C%E8%A1%A8/" style="font-size: 10px;">哈希表</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F/" style="font-size: 10px;">响应式</a> <a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 10px;">基础</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" style="font-size: 11.11px;">微前端</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 10px;">微服务</a> <a href="/tags/%E6%89%8B%E5%86%99/" style="font-size: 10px;">手写</a> <a href="/tags/%E6%8A%80%E5%B7%A7/" style="font-size: 10px;">技巧</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">排序</a> <a href="/tags/%E6%8F%92%E5%80%BC%E6%9F%A5%E6%89%BE/" style="font-size: 10px;">插值查找</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 10px;">教程</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E3%80%81%E7%AE%97%E6%B3%95/" style="font-size: 10px;">数据、算法</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9/" style="font-size: 10px;">数据压缩</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94%E5%BC%8F/" style="font-size: 10px;">数据响应式</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">数据结构</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" style="font-size: 10px;">数据结构与算法</a> <a href="/tags/%E6%95%B0%E7%BB%84%E5%AE%9E%E7%8E%B0%E5%8C%85/" style="font-size: 10px;">数组实现包</a> <a href="/tags/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%9F%A5%E6%89%BE/" style="font-size: 10px;">斐波那契查找</a> <a href="/tags/%E6%96%AD%E7%82%B9%E7%BB%AD%E4%BC%A0/" style="font-size: 10px;">断点续传</a> <a href="/tags/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/" style="font-size: 10px;">权限管理</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 12.22px;">架构</a> <a href="/tags/%E6%A0%88/" style="font-size: 10px;">栈</a> <a href="/tags/%E6%A8%A1%E5%9D%97%E6%89%93%E5%8C%85/" style="font-size: 10px;">模块打包</a> <a href="/tags/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/" style="font-size: 10px;">模板引擎</a> <a href="/tags/%E6%A8%A1%E6%9D%BF%E8%A7%A3%E6%9E%90/" style="font-size: 10px;">模板解析</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 14.44px;">源码</a> <a href="/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" style="font-size: 15.56px;">源码解析</a> <a href="/tags/%E7%80%91%E5%B8%83%E6%B5%81/" style="font-size: 10px;">瀑布流</a> <a href="/tags/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" style="font-size: 10px;">生命周期</a> <a href="/tags/%E7%A8%80%E7%96%8F%E6%95%B0%E7%BB%84/" style="font-size: 10px;">稀疏数组</a> <a href="/tags/%E7%AC%AC%E4%B8%80%E7%AB%A0/" style="font-size: 10px;">第一章</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 20px;">算法</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%E8%AE%A1%E7%AE%97/" style="font-size: 10px;">算法 -时间复杂度计算</a> <a href="/tags/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%B8%88%E8%80%83%E8%AF%95/" style="font-size: 10px;">系统架构设计师考试</a> <a href="/tags/%E7%BA%A6%E7%91%9F%E5%A4%AB%E9%97%AE%E9%A2%98/" style="font-size: 10px;">约瑟夫问题</a> <a href="/tags/%E7%BB%84%E4%BB%B6/" style="font-size: 10px;">组件</a> <a href="/tags/%E7%BB%84%E4%BB%B6%E5%8C%96/" style="font-size: 10px;">组件化</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E9%A2%98/" style="font-size: 10px;">编程题</a> <a href="/tags/%E8%99%9A%E6%8B%9FDOM%E4%B8%8Ediff%E7%AE%97%E6%B3%95/" style="font-size: 10px;">虚拟DOM与diff算法</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 12.22px;">读书笔记</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-React-%E3%80%8A%E6%B7%B1%E5%85%A5React%E6%8A%80%E6%9C%AF%E6%A0%88%E3%80%8B/" style="font-size: 10px;">读书笔记 - React - 《深入React技术栈》</a> <a href="/tags/%E8%B8%A9%E5%9D%91/" style="font-size: 10px;">踩坑</a> <a href="/tags/%E8%BF%B7%E5%AE%AB%E5%9B%9E%E6%BA%AF/" style="font-size: 10px;">迷宫回溯</a> <a href="/tags/%E9%80%86%E6%B3%A2%E5%85%B0%E5%BC%8F/" style="font-size: 10px;">逆波兰式</a> <a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size: 10px;">链表</a> <a href="/tags/%E9%98%9F%E5%88%97/" style="font-size: 10px;">队列</a> <a href="/tags/%E9%9B%86%E7%BE%A4/" style="font-size: 10px;">集群</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 16.67px;">面试题</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>

<script src="/js/search.js"></script>


<script src="/js/main.js"></script>



  <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
  <div id="particles"></div>
  
<script src="/js/particles.js"></script>








  
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">

  <script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script>
  
<script src="/js/animate.js"></script>



  
<script src="/js/pop-img.js"></script>

  <script>
     $(".article-entry p img").popImg();
  </script>

  </div>
</body>
</html>